!function(name,context,definition){"undefined"!=typeof module?module.exports=definition(name,context):"function"==typeof define&&"object"==typeof define.amd?define(definition):context[name]=definition(name,context)}("bean",this,function(name,context){var win=window,old=context[name],overOut=/over|out/,namespaceRegex=/[^\.]*(?=\..*)\.|.*/,nameRegex=/\..*/,addEvent="addEventListener",attachEvent="attachEvent",removeEvent="removeEventListener",detachEvent="detachEvent",doc=document||{},root=doc.documentElement||{},W3C_MODEL=root[addEvent],eventSupport=W3C_MODEL?addEvent:attachEvent,slice=Array.prototype.slice,mouseTypeRegex=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,mouseWheelTypeRegex=/mouse.*(wheel|scroll)/i,textTypeRegex=/^text/i,touchTypeRegex=/^touch|^gesture/i,ONE={one:1},nativeEvents=function(hash,events,i){for(i=0;i<events.length;i++)hash[events[i]]=1;return hash}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(W3C_MODEL?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),customEvents=function(){function isDescendant(parent,node){for(;null!==(node=node.parentNode);)if(node===parent)return!0;return!1}function check(event){var related=event.relatedTarget;return related?related!==this&&"xul"!==related.prefix&&!/document/.test(this.toString())&&!isDescendant(this,related):null===related}return{mouseenter:{base:"mouseover",condition:check},mouseleave:{base:"mouseout",condition:check},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),fixEvent=function(){var commonProps="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),mouseProps=commonProps.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),mouseWheelProps=mouseProps.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),keyProps=commonProps.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),textProps=commonProps.concat(["data"]),touchProps=commonProps.concat("touches targetTouches changedTouches scale rotation".split(" ")),preventDefault="preventDefault",createPreventDefault=function(event){return function(){event[preventDefault]?event[preventDefault]():event.returnValue=!1}},stopPropagation="stopPropagation",createStopPropagation=function(event){return function(){event[stopPropagation]?event[stopPropagation]():event.cancelBubble=!0}},createStop=function(synEvent){return function(){synEvent[preventDefault](),synEvent[stopPropagation](),synEvent.stopped=!0}},copyProps=function(event,result,props){var i,p;for(i=props.length;i--;)p=props[i],!(p in result)&&p in event&&(result[p]=event[p])};return function(event,isNative){var result={originalEvent:event,isNative:isNative};if(!event)return result;var props,type=event.type,target=event.target||event.srcElement;return result[preventDefault]=createPreventDefault(event),result[stopPropagation]=createStopPropagation(event),result.stop=createStop(result),result.target=target&&3===target.nodeType?target.parentNode:target,isNative&&(-1!==type.indexOf("key")?(props=keyProps,result.keyCode=event.which||event.keyCode):mouseTypeRegex.test(type)?(props=mouseProps,result.rightClick=3===event.which||2===event.button,result.pos={x:0,y:0},event.pageX||event.pageY?(result.clientX=event.pageX,result.clientY=event.pageY):(event.clientX||event.clientY)&&(result.clientX=event.clientX+doc.body.scrollLeft+root.scrollLeft,result.clientY=event.clientY+doc.body.scrollTop+root.scrollTop),overOut.test(type)&&(result.relatedTarget=event.relatedTarget||event[("mouseover"===type?"from":"to")+"Element"])):touchTypeRegex.test(type)?props=touchProps:mouseWheelTypeRegex.test(type)?props=mouseWheelProps:textTypeRegex.test(type)&&(props=textProps),copyProps(event,result,props||commonProps)),result}}(),targetElement=function(element,isNative){return W3C_MODEL||isNative||element!==doc&&element!==win?element:root},RegEntry=function(){function entry(element,type,handler,original,namespaces){this.element=element,this.type=type,this.handler=handler,this.original=original,this.namespaces=namespaces,this.custom=customEvents[type],this.isNative=nativeEvents[type]&&element[eventSupport],this.eventType=W3C_MODEL||this.isNative?type:"propertychange",this.customType=!W3C_MODEL&&!this.isNative&&type,this.target=targetElement(element,this.isNative),this.eventSupport=this.target[eventSupport]}return entry.prototype={inNamespaces:function(checkNamespaces){var i,j;if(!checkNamespaces)return!0;if(!this.namespaces)return!1;for(i=checkNamespaces.length;i--;)for(j=this.namespaces.length;j--;)if(checkNamespaces[i]===this.namespaces[j])return!0;return!1},matches:function(checkElement,checkOriginal,checkHandler){return!(this.element!==checkElement||checkOriginal&&this.original!==checkOriginal||checkHandler&&this.handler!==checkHandler)}},entry}(),registry=function(){var map={},forAll=function(element,type,original,handler,fn){if(type&&"*"!==type){var l,i=0,list=map["$"+type],all="*"===element;if(!list)return;for(l=list.length;l>i;i++)if((all||list[i].matches(element,original,handler))&&!fn(list[i],list,i,type))return}else for(var t in map)"$"===t.charAt(0)&&forAll(element,t.substr(1),original,handler,fn)},has=function(element,type,original){var i,list=map["$"+type];if(list)for(i=list.length;i--;)if(list[i].matches(element,original,null))return!0;return!1},get=function(element,type,original){var entries=[];return forAll(element,type,original,null,function(entry){return entries.push(entry)}),entries},put=function(entry){return(map["$"+entry.type]||(map["$"+entry.type]=[])).push(entry),entry},del=function(entry){forAll(entry.element,entry.type,null,entry.handler,function(entry,list,i){return list.splice(i,1),0===list.length&&delete map["$"+entry.type],!1})},entries=function(){var t,entries=[];for(t in map)"$"===t.charAt(0)&&(entries=entries.concat(map[t]));return entries};return{has:has,get:get,put:put,del:del,entries:entries}}(),listener=W3C_MODEL?function(element,type,fn,add){element[add?addEvent:removeEvent](type,fn,!1)}:function(element,type,fn,add,custom){custom&&add&&null===element["_on"+custom]&&(element["_on"+custom]=0),element[add?attachEvent:detachEvent]("on"+type,fn)},nativeHandler=function(element,fn,args){return function(event){return event=fixEvent(event||((this.ownerDocument||this.document||this).parentWindow||win).event,!0),fn.apply(element,[event].concat(args))}},customHandler=function(element,fn,type,condition,args,isNative){return function(event){(condition?condition.apply(this,arguments):W3C_MODEL?!0:event&&event.propertyName==="_on"+type||!event)&&(event&&(event=fixEvent(event||((this.ownerDocument||this.document||this).parentWindow||win).event,isNative)),fn.apply(element,!event||args&&0!==args.length?slice.call(arguments,event?0:1).concat(args):arguments))}},once=function(rm,element,type,fn,originalFn){return function(){rm(element,type,originalFn),fn.apply(this,arguments)}},removeListener=function(element,orgType,handler,namespaces){var i,l,entry,type=orgType&&orgType.replace(nameRegex,""),handlers=registry.get(element,type,handler);for(i=0,l=handlers.length;l>i;i++)handlers[i].inNamespaces(namespaces)&&((entry=handlers[i]).eventSupport&&listener(entry.target,entry.eventType,entry.handler,!1,entry.type),registry.del(entry))},addListener=function(element,orgType,fn,originalFn,args){var entry,type=orgType.replace(nameRegex,""),namespaces=orgType.replace(namespaceRegex,"").split(".");return registry.has(element,type,fn)?element:("unload"===type&&(fn=once(removeListener,element,type,fn,originalFn)),customEvents[type]&&(customEvents[type].condition&&(fn=customHandler(element,fn,type,customEvents[type].condition,!0)),type=customEvents[type].base||type),entry=registry.put(new RegEntry(element,type,fn,originalFn,namespaces[0]&&namespaces)),entry.handler=entry.isNative?nativeHandler(element,entry.handler,args):customHandler(element,entry.handler,type,!1,args,!1),entry.eventSupport&&listener(entry.target,entry.eventType,entry.handler,!0,entry.customType),void 0)},del=function(selector,fn,$){return function(e){var target,i,array="string"==typeof selector?$(selector,this):selector;for(target=e.target;target&&target!==this;target=target.parentNode)for(i=array.length;i--;)if(array[i]===target)return fn.apply(target,arguments)}},remove=function(element,typeSpec,fn){var k,type,namespaces,i,rm=removeListener,isString=typeSpec&&"string"==typeof typeSpec;if(isString&&typeSpec.indexOf(" ")>0){for(typeSpec=typeSpec.split(" "),i=typeSpec.length;i--;)remove(element,typeSpec[i],fn);return element}if(type=isString&&typeSpec.replace(nameRegex,""),type&&customEvents[type]&&(type=customEvents[type].type),!typeSpec||isString)(namespaces=isString&&typeSpec.replace(namespaceRegex,""))&&(namespaces=namespaces.split(".")),rm(element,type,fn,namespaces);else if("function"==typeof typeSpec)rm(element,null,typeSpec);else for(k in typeSpec)typeSpec.hasOwnProperty(k)&&remove(element,k,typeSpec[k]);return element},add=function(element,events,fn,delfn,$){var type,types,i,args,originalFn=fn,isDel=fn&&"string"==typeof fn;if(events&&!fn&&"object"==typeof events)for(type in events)events.hasOwnProperty(type)&&add.apply(this,[element,type,events[type]]);else for(args=arguments.length>3?slice.call(arguments,3):[],types=(isDel?fn:events).split(" "),isDel&&(fn=del(events,originalFn=delfn,$))&&(args=slice.call(args,1)),this===ONE&&(fn=once(remove,element,events,fn,originalFn)),i=types.length;i--;)addListener(element,types[i],fn,originalFn,args);return element},one=function(){return add.apply(ONE,arguments)},fireListener=W3C_MODEL?function(isNative,type,element){var evt=doc.createEvent(isNative?"HTMLEvents":"UIEvents");evt[isNative?"initEvent":"initUIEvent"](type,!0,!0,win,1),element.dispatchEvent(evt)}:function(isNative,type,element){element=targetElement(element,isNative),isNative?element.fireEvent("on"+type,doc.createEventObject()):element["_on"+type]++},fire=function(element,type,args){var i,j,l,names,handlers,types=type.split(" ");for(i=types.length;i--;)if(type=types[i].replace(nameRegex,""),(names=types[i].replace(namespaceRegex,""))&&(names=names.split(".")),names||args||!element[eventSupport])for(handlers=registry.get(element,type),args=[!1].concat(args),j=0,l=handlers.length;l>j;j++)handlers[j].inNamespaces(names)&&handlers[j].handler.apply(element,args);else fireListener(nativeEvents[type],type,element);return element},clone=function(element,from,type){for(var i=0,handlers=registry.get(from,type),l=handlers.length;l>i;i++)handlers[i].original&&add(element,handlers[i].type,handlers[i].original);return element},bean={add:add,one:one,remove:remove,clone:clone,fire:fire,noConflict:function(){return context[name]=old,this}};if(win[attachEvent]){var cleanup=function(){var i,entries=registry.entries();for(i in entries)entries[i].type&&"unload"!==entries[i].type&&remove(entries[i].element,entries[i].type);win[detachEvent]("onunload",cleanup),win.CollectGarbage&&win.CollectGarbage()};win[attachEvent]("onunload",cleanup)}return bean});// Copyright Google Inc.
var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};// Copyright (C) 2006 Google Inc.
var html=function(html4){function lookupEntity(name){if(name=lcase(name),ENTITIES.hasOwnProperty(name))return ENTITIES[name];var m=name.match(decimalEscapeRe);return m?String.fromCharCode(parseInt(m[1],10)):(m=name.match(hexEscapeRe))?String.fromCharCode(parseInt(m[1],16)):""}function decodeOneEntity(_,name){return lookupEntity(name)}function stripNULs(s){return s.replace(nulRe,"")}function unescapeEntities(s){return s.replace(entityRe,decodeOneEntity)}function escapeAttrib(s){return s.replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;").replace(quotRe,"&#34;").replace(eqRe,"&#61;")}function normalizeRCData(rcdata){return rcdata.replace(looseAmpRe,"&amp;$1").replace(ltRe,"&lt;").replace(gtRe,"&gt;")}function makeSaxParser(handler){return function(htmlText,param){htmlText=String(htmlText);var htmlLower=null,inTag=!1,attribs=[],tagName=void 0,eflags=void 0,openTag=void 0;for(handler.startDoc&&handler.startDoc(param);htmlText;){var m=htmlText.match(inTag?INSIDE_TAG_TOKEN:OUTSIDE_TAG_TOKEN);if(htmlText=htmlText.substring(m[0].length),inTag){if(m[1]){var decodedValue,attribName=lcase(m[1]);if(m[2]){var encodedValue=m[3];switch(encodedValue.charCodeAt(0)){case 34:case 39:encodedValue=encodedValue.substring(1,encodedValue.length-1)}decodedValue=unescapeEntities(stripNULs(encodedValue))}else decodedValue=attribName;attribs.push(attribName,decodedValue)}else if(m[4]){if(void 0!==eflags&&(openTag?handler.startTag&&handler.startTag(tagName,attribs,param):handler.endTag&&handler.endTag(tagName,param)),openTag&&eflags&(html4.eflags.CDATA|html4.eflags.RCDATA)){htmlLower=null===htmlLower?lcase(htmlText):htmlLower.substring(htmlLower.length-htmlText.length);var dataEnd=htmlLower.indexOf("</"+tagName);0>dataEnd&&(dataEnd=htmlText.length),dataEnd&&(eflags&html4.eflags.CDATA?handler.cdata&&handler.cdata(htmlText.substring(0,dataEnd),param):handler.rcdata&&handler.rcdata(normalizeRCData(htmlText.substring(0,dataEnd)),param),htmlText=htmlText.substring(dataEnd))}tagName=eflags=openTag=void 0,attribs.length=0,inTag=!1}}else if(m[1])handler.pcdata&&handler.pcdata(m[0],param);else if(m[3])openTag=!m[2],inTag=!0,tagName=lcase(m[3]),eflags=html4.ELEMENTS.hasOwnProperty(tagName)?html4.ELEMENTS[tagName]:void 0;else if(m[4])handler.pcdata&&handler.pcdata(m[4],param);else if(m[5]&&handler.pcdata){var ch=m[5];handler.pcdata("<"===ch?"&lt;":">"===ch?"&gt;":"&amp;",param)}}handler.endDoc&&handler.endDoc(param)}}function makeHtmlSanitizer(sanitizeAttributes){var stack,ignoring;return makeSaxParser({startDoc:function(){stack=[],ignoring=!1},startTag:function(tagName,attribs,out){if(!ignoring&&html4.ELEMENTS.hasOwnProperty(tagName)){var eflags=html4.ELEMENTS[tagName];if(!(eflags&html4.eflags.FOLDABLE)){if(eflags&html4.eflags.UNSAFE)return ignoring=!(eflags&html4.eflags.EMPTY),void 0;if(attribs=sanitizeAttributes(tagName,attribs)){eflags&html4.eflags.EMPTY||stack.push(tagName),out.push("<",tagName);for(var i=0,n=attribs.length;n>i;i+=2){var attribName=attribs[i],value=attribs[i+1];null!==value&&void 0!==value&&out.push(" ",attribName,'="',escapeAttrib(value),'"')}out.push(">")}}}},endTag:function(tagName,out){if(ignoring)return ignoring=!1,void 0;if(html4.ELEMENTS.hasOwnProperty(tagName)){var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags.UNSAFE|html4.eflags.EMPTY|html4.eflags.FOLDABLE))){var index;if(eflags&html4.eflags.OPTIONAL_ENDTAG)for(index=stack.length;--index>=0;){var stackEl=stack[index];if(stackEl===tagName)break;if(!(html4.ELEMENTS[stackEl]&html4.eflags.OPTIONAL_ENDTAG))return}else for(index=stack.length;--index>=0&&stack[index]!==tagName;);if(0>index)return;for(var i=stack.length;--i>index;){var stackEl=stack[i];html4.ELEMENTS[stackEl]&html4.eflags.OPTIONAL_ENDTAG||out.push("</",stackEl,">")}stack.length=index,out.push("</",tagName,">")}}},pcdata:function(text,out){ignoring||out.push(text)},rcdata:function(text,out){ignoring||out.push(text)},cdata:function(text,out){ignoring||out.push(text)},endDoc:function(out){for(var i=stack.length;--i>=0;)out.push("</",stack[i],">");stack.length=0}})}function sanitize(htmlText,opt_uriPolicy,opt_nmTokenPolicy){var out=[];return makeHtmlSanitizer(function(tagName,attribs){for(var i=0;i<attribs.length;i+=2){var attribKey,attribName=attribs[i],value=attribs[i+1],atype=null;if(attribKey=tagName+"::"+attribName,(html4.ATTRIBS.hasOwnProperty(attribKey)||(attribKey="*::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey)))&&(atype=html4.ATTRIBS[attribKey]),null!==atype)switch(atype){case html4.atype.NONE:break;case html4.atype.SCRIPT:case html4.atype.STYLE:value=null;break;case html4.atype.ID:case html4.atype.IDREF:case html4.atype.IDREFS:case html4.atype.GLOBAL_NAME:case html4.atype.LOCAL_NAME:case html4.atype.CLASSES:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;break;case html4.atype.URI:var parsedUri=(""+value).match(URI_SCHEME_RE);value=parsedUri?!parsedUri[1]||WHITELISTED_SCHEMES.test(parsedUri[1])?opt_uriPolicy&&opt_uriPolicy(value):null:null;break;case html4.atype.URI_FRAGMENT:value&&"#"===value.charAt(0)?(value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value,value&&(value="#"+value)):value=null;break;default:value=null}else value=null;attribs[i+1]=value}return attribs})(htmlText,out),out.join("")}var lcase;lcase="script"==="SCRIPT".toLowerCase()?function(s){return s.toLowerCase()}:function(s){return s.replace(/[A-Z]/g,function(ch){return String.fromCharCode(32|ch.charCodeAt(0))})};var ENTITIES={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',apos:"'"},WHITELISTED_SCHEMES=/^(?:https?|mailto|data)$/i,decimalEscapeRe=/^#(\d+)$/,hexEscapeRe=/^#x([0-9A-Fa-f]+)$/,nulRe=/\0/g,entityRe=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,ampRe=/&/g,looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,ltRe=/</g,gtRe=/>/g,quotRe=/\"/g,eqRe=/\=/g,INSIDE_TAG_TOKEN=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),OUTSIDE_TAG_TOKEN=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),URI_SCHEME_RE=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:escapeAttrib,makeHtmlSanitizer:makeHtmlSanitizer,makeSaxParser:makeSaxParser,normalizeRCData:normalizeRCData,sanitize:sanitize,unescapeEntities:unescapeEntities}}(html4),html_sanitize=html.sanitize;"undefined"!=typeof window&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache;!function(exports){"undefined"!=typeof module&&module.exports?module.exports=exports:"function"==typeof define?define(exports):Mustache=exports}(function(){function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return!testRe(nonSpaceRe,string)}function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parent){this.view=view,this.parent=parent,this.clearCache()}function Writer(){this.clearCache()}function sectionBounds(token){for(var tokens,start=token[3],end=start;(tokens=token[4])&&tokens.length;)token=tokens[tokens.length-1],end=token[3];return[start,end]}function compileTokens(tokens){function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template)}}return subRenders[i]}function renderFunction(writer,context,template){for(var token,sectionText,buffer="",i=0,len=tokens.length;len>i;++i)switch(token=tokens[i],token[0]){case"#":sectionText=template.slice.apply(template,sectionBounds(token)),buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1]}return buffer}var subRenders={};return renderFunction}function nestTokens(tokens){for(var token,section,tree=[],collector=tree,sections=[],i=0;i<tokens.length;++i)switch(token=tokens[i],token[0]){case"#":case"^":token[4]=[],sections.push(token),collector.push(token),collector=token[4];break;case"/":if(0===sections.length)throw new Error("Unopened section: "+token[1]);if(section=sections.pop(),section[1]!==token[1])throw new Error("Unclosed section: "+section[1]);collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token)}if(section=sections.pop())throw new Error("Unclosed section: "+section[1]);return tree}function squashTokens(tokens){for(var token,lastToken,i=0;i<tokens.length;++i)token=tokens[i],lastToken&&"text"===lastToken[0]&&"text"===token[0]?(lastToken[1]+=token[1],lastToken[3]=token[3],tokens.splice(i--,1)):lastToken=token}function escapeTags(tags){if(2!==tags.length)throw new Error("Invalid tags: "+tags.join(" "));return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}var exports={};exports.name="mustache.js",exports.version="0.7.0",exports.tags=["{{","}}"],exports.Scanner=Scanner,exports.Context=Context,exports.Writer=Writer;var whiteRe=/\s*/,spaceRe=/\s+/,nonSpaceRe=/\S/,eqRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/,isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};exports.escape=escapeHtml,Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);return match&&0===match.index?(this.tail=this.tail.substring(match[0].length),this.pos+=match[0].length,match[0]):""},Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos),this.tail=this.tail.substring(pos),this.pos+=pos}return match},Context.make=function(view){return view instanceof Context?view:new Context(view)},Context.prototype.clearCache=function(){this._cache={}},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if("."===name)value=this.view;else for(var context=this;context;){if(name.indexOf(".")>0){var names=name.split("."),i=0;for(value=context.view;value&&i<names.length;)value=value[names[i++]]}else value=context.view[name];if(null!=value)break;context=context.parent}this._cache[name]=value}return"function"==typeof value&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this._cache={},this._partialCache={}},Writer.prototype.compile=function(template,tags){return this._compile(this._cache,template,template,tags)},Writer.prototype.compilePartial=function(name,template,tags){return this._compile(this._partialCache,name,template,tags)},Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)},Writer.prototype._compile=function(cache,key,template,tags){if(!cache[key]){var tokens=exports.parse(template,tags),fn=compileTokens(tokens),self=this;cache[key]=function(view,partials){if(partials)if("function"==typeof partials)self._loadPartial=partials;else for(var name in partials)self.compilePartial(name,partials[name]);return fn(self,Context.make(view),template)}}return cache[key]},Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){for(var buffer="",i=0,len=value.length;len>i;++i)buffer+=callback(this,context.push(value[i]));return buffer}return value?callback(this,context.push(value)):"";case"function":var self=this,scopedRender=function(template){return self.render(template,context)};return value.call(context.view,text,scopedRender)||"";default:if(value)return callback(this,context)}return""},Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);return!value||isArray(value)&&0===value.length?callback(this,context):""},Writer.prototype._partial=function(name,context){name in this._partialCache||!this._loadPartial||this.compilePartial(name,this._loadPartial(name));var fn=this._partialCache[name];return fn?fn(context):""},Writer.prototype._name=function(name,context){var value=context.lookup(name);return"function"==typeof value&&(value=value.call(context.view)),null==value?"":String(value)},Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context))},exports.parse=function(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)tokens.splice(spaces.pop(),1);else spaces=[];hasTag=!1,nonSpace=!1}tags=tags||exports.tags;for(var start,type,value,chr,tagRes=escapeTags(tags),scanner=new Scanner(template),tokens=[],spaces=[],hasTag=!1,nonSpace=!1;!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(tagRes[0]))for(var i=0,len=value.length;len>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(start=scanner.pos,!scanner.scan(tagRes[0]))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type)value=scanner.scanUntil(eqRe),scanner.scan(eqRe),scanner.scanUntil(tagRes[1]);else if("{"===type){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe),scanner.scan(curlyRe),scanner.scanUntil(tagRes[1]),type="&"}else value=scanner.scanUntil(tagRes[1]);if(!scanner.scan(tagRes[1]))throw new Error("Unclosed tag at "+scanner.pos);tokens.push([type,value,start,scanner.pos]),("name"===type||"{"===type||"&"===type)&&(nonSpace=!0),"="===type&&(tags=value.split(spaceRe),tagRes=escapeTags(tags))}return squashTokens(tokens),nestTokens(tokens)};var _writer=new Writer;return exports.clearCache=function(){return _writer.clearCache()},exports.compile=function(template,tags){return _writer.compile(template,tags)},exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags)},exports.render=function(template,view,partials){return _writer.render(template,view,partials)},exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);return"function"!=typeof send?result:(send(result),void 0)},exports}()),!function(e,t){"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):this[e]=t()}("reqwest",function(){function handleReadyState(e,t,n){return function(){e&&4==e[readyState]&&(twoHundo.test(e.status)?t(e):n(e))}}function setHeaders(e,t){var r,n=t.headers||{};n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=-1!==navigator.userAgent.indexOf("MSIE 10.0");a?"?"===a[3]?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,"undefined"!=typeof f.onreadystatechange&&!c&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){return f[readyState]&&"complete"!==f[readyState]&&"loaded"!==f[readyState]||l?!1:(f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=void 0,head.removeChild(f),l=1,void 0)},head.appendChild(f)}function getRequest(e,t,n){var o,r=(e.method||"GET").toUpperCase(),i="string"==typeof e?e:e.url,s=e.processData!==!1&&e.data&&"string"!=typeof e.data?reqwest.toQueryString(e.data):e.data||null;return("jsonp"==e.type||"GET"==r)&&s&&(i=urlappend(i,s),s=null),"jsonp"==e.type?handleJsonp(e,t,n,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,e),setCredentials(o,e),o.onreadystatechange=handleReadyState(o,t,n),e.before&&e.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);self._fulfillmentHandlers.length>0;)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){for(self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest(o,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&n)switch(r){case"input":if(!/reset|button|image|file/i.test(e.type)){var s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value;(!s&&!o||e.checked)&&t(n,normalize(s&&""===u?"on":u))}break;case"textarea":t(n,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(var a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var t,n,r,e=this,i=function(t,n){for(var i=0;i<n.length;i++){var s=t[byTag](n[i]);for(r=0;r<s.length;r++)serial(s[r],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),i(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return this._fulfilled?e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var n,t="",r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"};if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(var s in e)if(Object.hasOwnProperty.call(e,s)){var o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest}),wax=wax||{},wax.attribution=function(){var a={},container=document.createElement("div");return container.className="map-attribution",a.content=function(x){return"undefined"==typeof x?container.innerHTML:(container.innerHTML=wax.u.sanitize(x),this)},a.element=function(){return container},a.init=function(){return this},a},wax=wax||{},wax.bwdetect=function(options,callback){function bwTest(){wax.bw=-1;var im=new Image;im.src=testImage;var first=!0,timeout=setTimeout(function(){first&&-1==wax.bw&&(detector.bw(0),first=!1)},threshold);im.onload=function(){first&&-1==wax.bw&&(clearTimeout(timeout),detector.bw(1),first=!1)}}var detector={},threshold=options.threshold||400,testImage="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +new Date,bw=1,auto=void 0===options.auto?!0:options.auto;return detector.bw=function(x){return arguments.length?(wax.bwlisteners&&wax.bwlisteners.length&&function(){for(listeners=wax.bwlisteners,wax.bwlisteners=[],i=0;listeners>i;i++)listeners[i](x)}(),wax.bw=x,bw!=(bw=x)&&callback(x),void 0):bw},detector.add=function(){return auto&&bwTest(),this},-1==wax.bw?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(detector.bw)):void 0!==wax.bw?detector.bw(wax.bw):detector.add(),detector},wax.formatter=function(x){var formatter={},f;if(x&&"string"==typeof x)try{eval("f = "+x)}catch(e){console&&console.log(e)}else f=x&&"function"==typeof x?x:function(){};return formatter.format=function(options,data){try{return wax.u.sanitize(f(options,data))}catch(e){console&&console.log(e)}},formatter},wax.gi=function(grid_tile,options){function resolveCode(key){return key>=93&&key--,key>=35&&key--,key-=32}options=options||{};var instance={},resolution=options.resolution||4,tileSize=options.tileSize||256;return instance.grid_tile=function(){return grid_tile},instance.getKey=function(x,y){return!grid_tile||!grid_tile.grid||0>y||0>x||Math.floor(y)>=tileSize||Math.floor(x)>=tileSize?void 0:resolveCode(grid_tile.grid[Math.floor(y/resolution)].charCodeAt(Math.floor(x/resolution)))},instance.gridFeature=function(x,y){var key=this.getKey(x,y),keys=grid_tile.keys;return keys&&keys[key]&&grid_tile.data[keys[key]]?grid_tile.data[keys[key]]:void 0},instance.tileFeature=function(x,y,tile_element){if(grid_tile){var offset=wax.u.offset(tile_element);return feature=this.gridFeature(x-offset.left,y-offset.top)}},instance},wax.gm=function(){function templatedGridUrl(template){return"string"==typeof template&&(template=[template]),function(url){if(url){var rx=new RegExp("/(\\d+)\\/(\\d+)\\/(\\d+)\\.[\\w\\._]+"),xyz=rx.exec(url);if(xyz)return template[parseInt(xyz[2],10)%template.length].replace(/\{z\}/g,xyz[1]).replace(/\{x\}/g,xyz[2]).replace(/\{y\}/g,xyz[3])}}}var tilejson,formatter,minZoom,maxZoom,resolution=4,manager={},gridUrl=function(url){return url?url.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json"):void 0};return manager.formatter=function(x){return arguments.length?(formatter=wax.formatter(x),manager):formatter},manager.template=function(x){return arguments.length?(formatter=wax.template(x),manager):formatter},manager.minZoom=function(x){return arguments.length?(minZoom=x,manager):minZoom},manager.maxZoom=function(x){return arguments.length?(maxZoom=x,manager):maxZoom},manager.gridUrl=function(x){return arguments.length?(gridUrl=x?"function"==typeof x?x:templatedGridUrl(x):function(){return null},manager):gridUrl},manager.getGrid=function(url,callback){var gurl=gridUrl(url);return formatter&&gurl?(wax.request.get(gurl,function(err,t){return err?callback(err,null):(callback(null,wax.gi(t,{formatter:formatter,resolution:resolution})),void 0)}),manager):callback(null,null)},manager.tilejson=function(x){return arguments.length?(x.template?manager.template(x.template):x.formatter?manager.formatter(x.formatter):formatter=void 0,manager.gridUrl(x.grids),manager.minZoom(x.gridminzoom||0),manager.maxZoom(x.gridmaxzoom||22),x.resolution&&(resolution=x.resolution),tilejson=x,manager):tilejson},manager},wax=wax||{},wax.hash=function(options){function getState(){return location.hash.substring(1)}function pushState(state){var l=window.location;l.replace(l.toString().replace(l.hash||/$/,"#"+state))}function parseHash(s){for(var args=s.split("/"),i=0;i<args.length;i++)if(args[i]=Number(args[i]),isNaN(args[i]))return!0;return args.length<3?!0:(3==args.length&&options.setCenterZoom(args),void 0)}function move(){var s1=options.getCenterZoom();s0!==s1&&(s0=s1,pushState(s0))}function stateChange(state){state!==s0&&parseHash(s0=state)&&move()}options=options||{};var s0,hash={},_move=wax.u.throttle(move,500);return hash.add=function(){return stateChange(getState()),options.bindChange(_move),hash},hash.remove=function(){return options.unbindChange(_move),hash},hash},wax=wax||{},wax.interaction=function(){function getTile(e){for(var g=grid(),i=0;i<g.length;i++)if(g[i][0]<e.y&&g[i][0]+256>e.y&&g[i][1]<e.x&&g[i][1]+256>e.x)return g[i][2];return!1}function killTimeout(){return _clickTimeout?(window.clearTimeout(_clickTimeout),_clickTimeout=null,!0):!1}function onMove(e){if(!_downLock){var pos=wax.u.eventoffset(e);interaction.screen_feature(pos,function(feature){feature?bean.fire(interaction,"on",{parent:parent(),data:feature,formatter:gm.formatter().format,e:e}):bean.fire(interaction,"off")})}}function dragEnd(){_downLock=!1}function onDown(e){_downLock=!0,_d=wax.u.eventoffset(e),"mousedown"===e.type?(bean.add(document.body,"click",onUp),bean.add(document.body,"mouseup",dragEnd)):"touchstart"===e.type&&1===e.touches.length&&(bean.fire(interaction,"off"),bean.add(e.srcElement,touchEnds))}function touchCancel(e){bean.remove(e.srcElement,touchEnds),_downLock=!1}function onUp(e){var evt={},pos=wax.u.eventoffset(e);_downLock=!1;for(var key in e)evt[key]=e[key];return bean.remove(document.body,"mouseup",onUp),bean.remove(e.srcElement,touchEnds),"touchend"===e.type?interaction.click(e,_d):Math.round(pos.y/tol)===Math.round(_d.y/tol)&&Math.round(pos.x/tol)===Math.round(_d.x/tol)&&(_clickTimeout?killTimeout():_clickTimeout=window.setTimeout(function(){_clickTimeout=null,interaction.click(evt,pos)},300)),onUp}var _d,grid,attach,detach,parent,map,gm=wax.gm(),interaction={},_downLock=!1,_clickTimeout=null,tol=4,defaultEvents={mousemove:onMove,touchstart:onDown,mousedown:onDown},touchEnds={touchend:onUp,touchmove:onUp,touchcancel:touchCancel};return interaction.click=function(e,pos){interaction.screen_feature(pos,function(feature){feature&&bean.fire(interaction,"on",{parent:parent(),data:feature,formatter:gm.formatter().format,e:e})})},interaction.screen_feature=function(pos,callback){var zoom=map.getZoom(),ignoreThisZoom=zoom<gm.minZoom()||zoom>gm.maxZoom(),tile=ignoreThisZoom?"undefined":getTile(pos);tile||callback(null),gm.getGrid(tile.src,function(err,g){if(err||!g)return callback(null);var feature=g.tileFeature(pos.x,pos.y,tile);callback(feature)})},interaction.attach=function(x){return arguments.length?(attach=x,interaction):attach},interaction.detach=function(x){return arguments.length?(detach=x,interaction):detach},interaction.map=function(x){return arguments.length?(map=x,attach&&attach(map),bean.add(parent(),defaultEvents),bean.add(parent(),"touchstart",onDown),interaction):map},interaction.grid=function(x){return arguments.length?(grid=x,interaction):grid},interaction.remove=function(){return detach&&detach(map),bean.remove(parent(),defaultEvents),bean.fire(interaction,"remove"),interaction},interaction.tilejson=function(x){return arguments.length?(gm.tilejson(x),interaction):gm.tilejson()},interaction.formatter=function(){return gm.formatter()},interaction.on=function(ev,fn){return bean.add(interaction,ev,fn),interaction},interaction.off=function(ev,fn){return bean.remove(interaction,ev,fn),interaction},interaction.gridmanager=function(x){return arguments.length?(gm=x,interaction):gm},interaction.parent=function(x){return parent=x,interaction},interaction};var wax=wax||{};wax.legend=function(){var element,container,legend={};return legend.element=function(){return container},legend.content=function(content){return arguments.length?(element.innerHTML=wax.u.sanitize(content),element.style.display="block",""===element.innerHTML&&(element.style.display="none"),legend):element.innerHTML},legend.add=function(){return container=document.createElement("div"),container.className="map-legends wax-legends",element=container.appendChild(document.createElement("div")),element.className="map-legend wax-legend",element.style.display="none",legend},legend.add()};var wax=wax||{};wax.location=function(){function on(o){if("mousemove"!==o.e.type&&o.e.type){var loc=o.formatter({format:"location"},o.data);loc&&(window.top.location.href=loc)}}var t={};return t.events=function(){return{on:on}},t};var wax=wax||{};wax.movetip={},wax.movetip=function(){function moveTooltip(e){var eo=wax.u.eventoffset(e);_tooltipOffset.height+eo.y>_contextOffset.top+_contextOffset.height&&_contextOffset.height>_tooltipOffset.height&&(eo.y-=_tooltipOffset.height,tooltip.className+=" flip-y"),_tooltipOffset.width+eo.x>_contextOffset.left+_contextOffset.width&&(eo.x-=_tooltipOffset.width,tooltip.className+=" flip-x"),tooltip.style.left=eo.x+"px",tooltip.style.top=eo.y+"px"}function getTooltip(feature){var tooltip=document.createElement("div");return tooltip.className="map-tooltip map-tooltip-0",tooltip.innerHTML=feature,tooltip}function hide(){tooltip&&(tooltip.parentNode.removeChild(tooltip),tooltip=null)}function on(o){var content;if(!popped){if("mousemove"!==o.e.type&&o.e.type){if(content=o.formatter({format:"teaser"},o.data),!content)return;hide();var tt=document.body.appendChild(getTooltip(content));tt.className+=" map-popup";var close=tt.appendChild(document.createElement("a"));close.href="#close",close.className="close",close.innerHTML="Close",popped=!0,tooltip=tt,_tooltipOffset=wax.u.offset(tooltip),_contextOffset=wax.u.offset(parent),moveTooltip(o.e),bean.add(close,"click touchend",function(e){e.stop(),hide(),popped=!1})}else{if(content=o.formatter({format:"teaser"},o.data),!content)return;hide(),parent.style.cursor="pointer",tooltip=document.body.appendChild(getTooltip(content))}tooltip&&(_tooltipOffset=wax.u.offset(tooltip),_contextOffset=wax.u.offset(parent),moveTooltip(o.e))}}function off(){parent.style.cursor="default",popped||hide()}var _tooltipOffset,_contextOffset,tooltip,parent,popped=!1,t={};return t.parent=function(x){return arguments.length?(parent=x,t):parent},t.events=function(){return{on:on,off:off}},t};var wax=wax||{};if(wax.request={cache:{},locks:{},promises:{},get:function(url,callback){if(this.cache[url])return callback(this.cache[url][0],this.cache[url][1]);
if(this.promises[url]=this.promises[url]||[],this.promises[url].push(callback),!this.locks[url]){var that=this;this.locks[url]=!0,reqwest({url:url+(~url.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",success:function(data){that.locks[url]=!1,that.cache[url]=[null,data];for(var i=0;i<that.promises[url].length;i++)that.promises[url][i](that.cache[url][0],that.cache[url][1])},error:function(err){that.locks[url]=!1,that.cache[url]=[err,null];for(var i=0;i<that.promises[url].length;i++)that.promises[url][i](that.cache[url][0],that.cache[url][1])}})}}},wax.template=function(x){var template={};return template.format=function(options,data){var clone={};for(var key in data)clone[key]=data[key];return options.format&&(clone["__"+options.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(x,clone))},template},!wax)var wax={};wax.tilejson=function(url,callback){reqwest({url:url+(~url.indexOf("?")?"&":"?")+"callback=?",type:"jsonp",success:callback,error:callback})};var wax=wax||{};wax.tooltip={},wax.tooltip=function(){function getTooltip(feature){var tooltip=document.createElement("div");return tooltip.className="map-tooltip map-tooltip-0 wax-tooltip",tooltip.innerHTML=feature,tooltip}function remove(){this.parentNode&&this.parentNode.removeChild(this)}function hide(){for(var _ct;_ct=tooltips.pop();)animate&&transitionEvent?(bean.add(_ct,transitionEvent,remove),_ct.className+=" map-fade"):_ct.parentNode&&_ct.parentNode.removeChild(_ct)}function on(o){var content;if("mousemove"!==o.e.type&&o.e.type){if(content=o.content||o.formatter({format:"full"},o.data),!content&&(o.e.type&&o.e.type.match(/touch/)&&(content=o.content||o.formatter({format:"teaser"},o.data)),!content))return;hide(),parent.style.cursor="pointer";var tt=parent.appendChild(getTooltip(content));tt.className+=" map-popup wax-popup";var close=tt.appendChild(document.createElement("a"));close.href="#close",close.className="close",close.innerHTML="Close",popped=!0,tooltips.push(tt),bean.add(close,"touchstart mousedown",function(e){e.stop()}),bean.add(close,"click touchend",function(e){e.stop(),hide(),popped=!1})}else if(!popped){if(content=o.content||o.formatter({format:"teaser"},o.data),!content||content==_currentContent)return;hide(),parent.style.cursor="pointer",tooltips.push(parent.appendChild(getTooltip(content))),_currentContent=content}}function off(){parent.style.cursor="default",_currentContent=null,popped||hide()}var _currentContent,transitionEvent,parent,popped=!1,animate=!1,t={},tooltips=[];return void 0!==document.body.style["-webkit-transition"]?transitionEvent="webkitTransitionEnd":void 0!==document.body.style.MozTransition&&(transitionEvent="transitionend"),t.parent=function(x){return arguments.length?(parent=x,t):parent},t.animate=function(x){return arguments.length?(animate=x,t):animate},t.events=function(){return{on:on,off:off}},t};var wax=wax||{};wax.u={offset:function(el){var width=el.offsetWidth||parseInt(el.style.width,10),height=el.offsetHeight||parseInt(el.style.height,10),doc_body=document.body,top=0,left=0,calculateOffset=function(el){if(el!==doc_body&&el!==document.documentElement){top+=el.offsetTop,left+=el.offsetLeft;var style=el.style.transform||el.style.WebkitTransform||el.style.OTransform||el.style.MozTransform||el.style.msTransform;if(style){var match;if(match=style.match(/translate\((.+)[px]?, (.+)[px]?\)/))top+=parseInt(match[2],10),left+=parseInt(match[1],10);else if(match=style.match(/translate3d\((.+)[px]?, (.+)[px]?, (.+)[px]?\)/))top+=parseInt(match[2],10),left+=parseInt(match[1],10);else if(match=style.match(/matrix3d\(([\-\d,\s]+)\)/)){var pts=match[1].split(",");top+=parseInt(pts[13],10),left+=parseInt(pts[12],10)}else(match=style.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))&&(top+=parseInt(match[2],10),left+=parseInt(match[1],10))}}};if("undefined"!=typeof el.getBoundingClientRect){var body=document.body,doc=el.ownerDocument.documentElement,clientTop=document.clientTop||body.clientTop||0,clientLeft=document.clientLeft||body.clientLeft||0,scrollTop=window.pageYOffset||doc.scrollTop,scrollLeft=window.pageXOffset||doc.scrollLeft,box=el.getBoundingClientRect();top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft}else{calculateOffset(el);try{for(;el=el.offsetParent;)calculateOffset(el)}catch(e){}}top+=doc_body.offsetTop,left+=doc_body.offsetLeft,top+=doc_body.parentNode.offsetTop,left+=doc_body.parentNode.offsetLeft;var htmlComputed=document.defaultView?window.getComputedStyle(doc_body.parentNode,null):doc_body.parentNode.currentStyle;return doc_body.parentNode.offsetTop===parseInt(htmlComputed.marginTop,10)||isNaN(parseInt(htmlComputed.marginTop,10))||(top+=parseInt(htmlComputed.marginTop,10),left+=parseInt(htmlComputed.marginLeft,10)),{top:top,left:left,height:height,width:width}},$:function(x){return"string"==typeof x?document.getElementById(x):x},eventoffset:function(e){return e||(e=window.event),e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:e.clientX||e.clientY?{x:e.clientX,y:e.clientY}:e.touches&&1===e.touches.length?{x:e.touches[0].pageX,y:e.touches[0].pageY}:void 0},limit:function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments,throttler=function(){timeout=null,func.apply(context,args)};debounce&&clearTimeout(timeout),(debounce||!timeout)&&(timeout=setTimeout(throttler,wait))}},throttle:function(func,wait){return this.limit(func,wait,!1)},sanitize:function(content){function urlX(url){return/^(https?:\/\/|data:image)/.test(url)?url:void 0}function idX(id){return id}return content?html_sanitize(content,urlX,idX):""}},wax=wax||{},wax.g=wax.g||{},wax.g.attribution=function(map,tilejson){tilejson=tilejson||{};var a,attribution={};return attribution.element=function(){return a.element()},attribution.appendTo=function(elem){return wax.u.$(elem).appendChild(a.element()),this},attribution.init=function(){return a=wax.attribution(),a.content(tilejson.attribution),a.element().className="map-attribution map-g",this},attribution.init()},wax=wax||{},wax.g=wax.g||{},wax.g.bwdetect=function(map,options){options=options||{};var lowpng=options.png||".png128",lowjpg=options.jpg||".jpg70";if(!map.mapTypes["mb-low"]){for(var mb=map.mapTypes.mb,tilejson={tiles:[],scheme:mb.options.scheme,blankImage:mb.options.blankImage,minzoom:mb.minZoom,maxzoom:mb.maxZoom,name:mb.name,description:mb.description},i=0;i<mb.options.tiles.length;i++)tilejson.tiles.push(mb.options.tiles[i].replace(".png",lowpng).replace(".jpg",lowjpg));m.mapTypes.set("mb-low",new wax.g.connector(tilejson))}return wax.bwdetect(options,function(bw){map.setMapTypeId(bw?"mb":"mb-low")})},wax=wax||{},wax.g=wax.g||{},wax.g.hash=function(map){return wax.hash({getCenterZoom:function(){var center=map.getCenter(),zoom=map.getZoom(),precision=Math.max(0,Math.ceil(Math.log(zoom)/Math.LN2));return[zoom.toFixed(2),center.lat().toFixed(precision),center.lng().toFixed(precision)].join("/")},setCenterZoom:function(args){map.setCenter(new google.maps.LatLng(args[1],args[2])),map.setZoom(args[0])},bindChange:function(fn){google.maps.event.addListener(map,"idle",fn)},unbindChange:function(fn){google.maps.event.removeListener(map,"idle",fn)}})},wax=wax||{},wax.g=wax.g||{},wax.g.interaction=function(){function setdirty(){dirty=!0}function grid(){if(!dirty&&_grid)return _grid;_grid=[];var zoom=map.getZoom();wax.u.offset(map.getDiv());var get=function(mapType){if(mapType&&mapType.interactive)for(var key in mapType.cache)if(key.split("/")[0]==zoom){var tileOffset=wax.u.offset(mapType.cache[key]);_grid.push([tileOffset.top,tileOffset.left,mapType.cache[key]])}};for(var i in map.mapTypes)get(map.mapTypes[i]);return map.overlayMapTypes.forEach(get),_grid}function attach(x){return arguments.length?(map=x,tileloadListener=google.maps.event.addListener(map,"tileloaded",setdirty),idleListener=google.maps.event.addListener(map,"idle",setdirty),void 0):map}function detach(){tileloadListener&&google.maps.event.removeListener(tileloadListener),idleListener&&google.maps.event.removeListener(idleListener)}var _grid,map,dirty=!1,tileloadListener=null,idleListener=null;return wax.interaction().attach(attach).detach(detach).parent(function(){return map.getDiv()}).grid(grid)},wax=wax||{},wax.g=wax.g||{},wax.g.legend=function(map,tilejson){tilejson=tilejson||{};var l,legend={};return legend.add=function(){return l=wax.legend().content(tilejson.legend||""),legend},legend.element=function(){return l.element()},legend.appendTo=function(elem){return wax.u.$(elem).appendChild(l.element()),legend},legend.add()};var wax=wax||{};wax.g=wax.g||{},wax.g.connector=function(options){options=options||{},this.options={tiles:options.tiles,scheme:options.scheme||"xyz",blankImage:options.blankImage||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},this.minZoom=options.minzoom||0,this.maxZoom=options.maxzoom||22,this.name=options.name||"",this.description=options.description||"",this.interactive=!0,this.tileSize=new google.maps.Size(256,256),this.cache={}},wax.g.connector.prototype.getTile=function(coord,zoom){var key=zoom+"/"+coord.x+"/"+coord.y;if(!this.cache[key]){var img=this.cache[key]=new Image(256,256);zoom<this.minZoom||zoom>this.maxZoom?(this.cache[key].src=this.options.blankImage,this.cache[key].style.display="none"):this.cache[key].src=this.getTileUrl(coord,zoom),this.cache[key].setAttribute("gTileKey",key),this.cache[key].onerror=function(){img.style.display="none"}}return this.cache[key]},wax.g.connector.prototype.releaseTile=function(tile){var key=tile.getAttribute("gTileKey");this.cache[key]&&delete this.cache[key],tile.parentNode&&tile.parentNode.removeChild(tile)},wax.g.connector.prototype.getTileUrl=function(coord,z){var mod=Math.pow(2,z),y="tms"===this.options.scheme?mod-1-coord.y:coord.y,x=coord.x%mod;return x=0>x?coord.x%mod+mod:x,0>y?this.options.blankImage:this.options.tiles[parseInt(x+y,10)%this.options.tiles.length].replace(/\{z\}/g,z).replace(/\{x\}/g,x).replace(/\{y\}/g,y)};