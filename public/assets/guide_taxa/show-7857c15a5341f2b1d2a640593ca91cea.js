function reuseGuideTaxon(btn,srcGuideTaxon,targetGuide){$.post("/guide_taxa.json",{"guide_taxon[guide_id]":targetGuide.id,guide_taxon_id:srcGuideTaxon.id}).success(function(json){$(btn).hide(),$(btn).after('<a href="/guide_taxa/'+json.guide_taxon.id+'" class="btn btn-link pull-right">'+I18n.t("view")+"</a>")}).error(function(xhr){var errors=$.parseJSON(xhr.responseText);alert(I18n.t("there_were_problems_adding_taxa",{errors:errors.join(", ")}))})}$(".taxonmap").taxonMap(),$(".imgmodal").on("shown",function(){$selection=$("img",this).not(".imagesloaded"),$selection.hide();var newHeight=.8*$(window).height();$(this).height(newHeight),$("img",this).css({height:newHeight+"px"}),$(this).css("margin-left",$("img",this).width()/-2+"px"),$(this).width($("img",this).width()),$("img:hidden",this).fadeIn()}),$(".imgmodal").imagesLoaded(function(){$("img",this).addClass("imagesloaded")}),$("#reuse_guide_taxon_dialog").on("shown",function(){var current=$(".modal-body",this);current.hasClass("loaded")||($.getJSON("/guides/user.json",function(json){for(var guides=[],i=0;i<json.length;i++)json[i].id!=GUIDE_TAXON.guide_id&&guides.push(json[i]);if(guides&&0!=guides.length){var ul=$("<div></div>");$.each(guides,function(){var guide=this;ul.append($('<div class="clear stacked lined"></div>').append($("<img/>").attr("src",this.icon_url||"/attachment_defaults/guides/icons/small_square.png"),$('<a href="/guides/'+this.id+'" class="btn btn-link">'+this.title+"</a>"),$('<a class="btn btn-success pull-right">'+I18n.t("add")+"</a>").click(function(){reuseGuideTaxon(this,GUIDE_TAXON,guide)})))}),current.html(ul)}else current.html("<p>"+I18n.t("you_are_not_editing_any_guides_add_one_html")+"</p>")}).error(function(){}),current.addClass("loaded"))});