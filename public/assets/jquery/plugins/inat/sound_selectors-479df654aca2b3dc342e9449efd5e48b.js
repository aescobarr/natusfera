!function($){function setup(wrapper,options){$(wrapper).data("soundSelectorOptions",options),$(wrapper).addClass("soundSelector");var existing=$(wrapper).contents();options.noControls||buildControls(wrapper,options);var container=$('<div class="soundSelectorSounds"></div>').css($.fn.soundSelector.defaults.containerCSS);container.addClass("clear"),$(wrapper).append(container),$(container).append(existing),options.queryOnLoad&&$(document).ready(function(){$.fn.soundSelector.querySounds(wrapper,options)})}function buildControls(wrapper,options){var controls=$('<div class="buttonrow soundSelectorControls"></div>').css($.fn.soundSelector.defaults.controlsCSS),$sourceWrapper=$('<span class="urlselect inter"><strong>'+I18n.t("source")+":</strong> </span>"),sourceSelect=$('<select class="select" disabled="disabled" style="margin: 0 auto"></select>'),option=$('<option value="soundcloud">SoundCloud</option>');sourceSelect.append(option),$sourceWrapper.append(sourceSelect),controls.append($sourceWrapper);var offset=$('<input class="soundSelectorOffset" type="hidden" value="0"/>'),prev=$('<a href="#" class="prevlink button">&laquo; '+I18n.t("prev")+"</a>").click(function(){var offsetnum=parseInt($(wrapper).find(".soundSelectorOffset").val());offsetnum-=options.limit,0>offsetnum&&(offsetnum=0);var prevOpts=$.extend({},$(wrapper).data("soundSelectorOptions"),{offset:offsetnum});return $.fn.soundSelector.querySounds(wrapper,prevOpts),$(wrapper).find(".soundSelectorOffset").val(offsetnum),!1}),next=$('<a href="#" class="nextlink button">'+I18n.t("next")+" &raquo;</a>").click(function(){var offsetnum=parseInt($(wrapper).find(".soundSelectorOffset").val());offsetnum+=options.limit;var nextOpts=$.extend({},$(wrapper).data("soundSelectorOptions"),{offset:offsetnum});return $.fn.soundSelector.querySounds(wrapper,nextOpts),$(wrapper).find(".soundSelectorOffset").val(offsetnum),!1});$(controls).append(offset,prev,next),$(controls).append($("<div></div>").css({height:0,visibility:"hidden",clear:"both"})),$(wrapper).append(controls)}$.fn.soundSelector=function(options){var options=$.extend(!0,{},$.fn.soundSelector.defaults,options);$(this).each(function(){setup(this,options)})},$.fn.soundSelector.querySounds=function(wrapper,options){var ajax=$(wrapper).data("ajax");"undefined"!=typeof ajax&&ajax.abort();var options=$.extend({},$.fn.soundSelector.defaults,$(wrapper).data("soundSelectorOptions"),options),params={limit:options.limit,offset:options.offset,index:options.index},baseURL=options.baseURL;$(wrapper).data("soundSelectorExisting")||$(wrapper).data("soundSelectorExisting",$(wrapper).find(".soundSelectorSounds input:checked").parent().clone());var $soundSelectorSounds=$(wrapper).find(".soundSelectorSounds"),loading=$('<center><span class="loading status inlineblock">'+I18n.t("loading")+"...</span></center>").css("margin-top",$soundSelectorSounds.height()/2-20);return $soundSelectorSounds.data("previous-overflow-x",$soundSelectorSounds.css("overflow-x")),$soundSelectorSounds.data("previous-overflow-y",$soundSelectorSounds.css("overflow-y")),$soundSelectorSounds.scrollTo(0,0),$soundSelectorSounds.css("overflow","hidden").shades("open",{css:{"background-color":"white",opacity:.7},content:loading}),ajax=$.ajax({url:baseURL,data:$.param(params),success:function(response){$soundSelectorSounds.html(response);var existing=$(wrapper).data("soundSelectorExisting"),existingValues=$(existing).find("input").map(function(){return $(this).val()});if($("input",$soundSelectorSounds).each(function(){-1!=$.inArray($(this).val(),existingValues)&&$(this).parent().remove()}),existing&&existing.length>0){$soundSelectorSounds.children().wrapAll('<div class="soundSelectorResults"></div>');var selectedSoundsWrapper=$('<div class="soundSelectorSelected"></div>').html("<h4>"+I18n.t("sounds.selected_sounds")+"</h4>");selectedSoundsWrapper.append(existing),$soundSelectorSounds.prepend(selectedSoundsWrapper)}return $(wrapper).data("soundSelectorExisting",null),$soundSelectorSounds.shades("close"),$soundSelectorSounds.css("overflow-x",$soundSelectorSounds.data("previous-overflow-x")),$soundSelectorSounds.css("overflow-y",$soundSelectorSounds.data("previous-overflow-y")),"function"==typeof options.afterQuerySounds&&options.afterQuerySounds(q,wrapper,options),!0}}),$(wrapper).data("ajax",ajax),!1},$.fn.soundSelector.defaults={baseURL:"/soundcloud_sounds",limit:20,offset:0,index:0,queryOnLoad:!0,formInputCSS:{"float":"left","margin-top":0},controlsCSS:{},containerCSS:{}}}(jQuery);