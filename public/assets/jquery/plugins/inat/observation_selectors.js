!function($){function setup(wrapper,options){var existing=$(wrapper).contents(),controls=$('<div class="observationSelectorControls"></div>').css($.fn.observationSelector.defaults.controlsCSS),input=$('<input type="text" class="text observationSelectorSearch"/>').css($.extend($.fn.observationSelector.defaults.controlsCSS,{display:"none"}));"undefined"!=typeof options.defaultQuery&&$(input).val(options.defaultQuery);var button=$('<a href="#" class="button observationSelectorSearchButton">'+I18n.t("find_observations")+"</a>").css($.extend($.fn.observationSelector.defaults.controlsCSS,{display:"none"})),page=$('<input class="observationSelectorPage" type="hidden" value="1"/>'),prev=$('<a href="#" class="prevlink button">&laquo; '+I18n.t("prev")+"</a>").click(function(){var pagenum=parseInt($(wrapper).find(".observationSelectorPage").val());pagenum-=1,1>pagenum&&(pagenum=1);var prevOpts=$.extend({},options);return prevOpts.urlParams=$.extend({},prevOpts.urlParams,{page:pagenum}),$.fn.observationSelector.queryObservations(options.baseURL,$(input).val(),wrapper,prevOpts),$(wrapper).find(".observationSelectorPage").val(pagenum),!1}),next=$('<a href="#" class="nextlink button">'+I18n.t("next")+" &raquo;</a>").click(function(){var pagenum=parseInt($(wrapper).find(".observationSelectorPage").val());pagenum+=1;var nextOpts=$.extend({},options);return nextOpts.urlParams=$.extend({},nextOpts.urlParams,{page:pagenum}),$.fn.observationSelector.queryObservations(options.baseURL,$(input).val(),wrapper,nextOpts),$(wrapper).find(".observationSelectorPage").val(pagenum),!1}),selectAll=$('<a href="#" class="selectall button">'+I18n.t("select_all")+"</a>").click(function(){return $(wrapper).find("input:checkbox").attr("checked",!0),!1}),selectNone=$('<a href="#" class="selectnone button">'+I18n.t("select_none")+"</a>").click(function(){return $(wrapper).find("input:checkbox").attr("checked",!1),!1});$(controls).append(input,button,page,prev,selectAll,selectNone,next,$("<div></div>").css({height:0,visibility:"hidden",clear:"both"})),$(wrapper).append(controls);var container=$('<div class="observationSelectorObservations"></div>').css($.fn.observationSelector.defaults.containerCSS);$(wrapper).append(container),$(container).append(existing),$(button).click(function(){return $(wrapper).find(".observationSelectorPage").val(1),$.fn.observationSelector.queryObservations(options.baseURL,$(input).val(),wrapper,options),!1}),$(input).keypress(function(e){if(13==e.which){try{$(wrapper).find(".observationSelectorPage").val(1),$.fn.observationSelector.queryObservations(options.baseURL,$(input).val(),wrapper,options)}catch(e){alert(e)}return!1}}),options.queryOnLoad&&$(document).ready(function(){var q="";"string"==typeof options.defaultQuery&&(q=options.defaultQuery),$.fn.observationSelector.queryObservations(options.baseURL,q,wrapper,options)})}$.fn.observationSelector=function(options){var options=$.extend({},$.fn.observationSelector.defaults,options);$(this).each(function(){setup(this,options)})},$.fn.observationSelector.queryObservations=function(baseURL,q,wrapper,options){var options=options||{},params=$.extend({},options.urlParams,{q:q}),existing=$(wrapper).find(".observationSelectorObservations input:checked").parents(".observation").clone();return $(wrapper).find(".observationSelectorObservations").addClass("loading status").html(existing).prepend("Loading..."),$.get(baseURL,params,function(responseText){$(wrapper).find(".observationSelectorObservations").html(responseText);var existingValues=$(existing).find("input").map(function(){return $(this).val()});$(this).find("input").each(function(){-1!=$.inArray($(this).val(),existingValues)&&$(this).parents(".observation").remove()}),$(wrapper).find(".observationSelectorObservations").prepend(existing),$(wrapper).find(".observationSelectorObservations").removeClass("loading status"),"undefined"!=typeof $.fn.labelize&&$(".observation",wrapper).labelize()}),!1},$.fn.observationSelector.defaults={baseURL:"/observations/selector",queryOnLoad:!0,formInputCSS:{"float":"left","margin-top":0},controlsCSS:{},containerCSS:{"background-position":"top left"}}}(jQuery);