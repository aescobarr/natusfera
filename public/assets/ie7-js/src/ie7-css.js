var HYPERLINK=/a(#[\w-]+)?(\.[\w-]+)?:(hover|active)/i,BRACE1=/\s*\{\s*/,BRACE2=/\s*\}\s*/,COMMA=/\s*\,\s*/,FIRST_LINE_LETTER=/(.*)(:first-(line|letter))/,styleSheets=document.styleSheets;IE7.CSS=new(Fix.extend({parser:new Parser,screen:"",print:"",styles:[],rules:[],pseudoClasses:7>appVersion?"first\\-child":"",dynamicPseudoClasses:{toString:function(){var strings=[];for(var pseudoClass in this)strings.push(pseudoClass);return strings.join("|")}},init:function(){var NONE="^$",CLASS="\\[class=?[^\\]]*\\]",pseudoClasses=[];this.pseudoClasses&&pseudoClasses.push(this.pseudoClasses);var dynamicPseudoClasses=this.dynamicPseudoClasses.toString();dynamicPseudoClasses&&pseudoClasses.push(dynamicPseudoClasses),pseudoClasses=pseudoClasses.join("|");var unknown=7>appVersion?["[>+~[(]|([:.])\\w+\\1"]:[CLASS];pseudoClasses&&unknown.push(":("+pseudoClasses+")"),this.UNKNOWN=new RegExp(unknown.join("|")||NONE,"i");var complex=7>appVersion?["\\[[^\\]]+\\]|[^\\s(\\[]+\\s*[+~]"]:[CLASS],complexRule=complex.concat();pseudoClasses&&complexRule.push(":("+pseudoClasses+")"),Rule.COMPLEX=new RegExp(complexRule.join("|")||NONE,"ig"),this.pseudoClasses&&complex.push(":("+this.pseudoClasses+")"),DynamicRule.COMPLEX=new RegExp(complex.join("|")||NONE,"i"),DynamicRule.MATCH=new RegExp(dynamicPseudoClasses?"(.*):("+dynamicPseudoClasses+")(.*)":NONE,"i"),this.createStyleSheet(),this.refresh()},addEventHandler:function(){addEventHandler.apply(null,arguments)},addFix:function(expression,replacement){this.parser.add(expression,replacement)},addRecalc:function(propertyName,test,handler,replacement){test=new RegExp("([{;\\s])"+propertyName+"\\s*:\\s*"+test+"[^;}]*");var id=this.recalcs.length;return replacement&&(replacement=propertyName+":"+replacement),this.addFix(test,function(match,$1){return(replacement?$1+replacement:match)+";ie7-"+match.slice(1)+";ie7_recalc"+id+":1"}),this.recalcs.push(arguments),id},apply:function(){this.getInlineStyles(),new StyleSheet("screen"),this.trash()},createStyleSheet:function(){this.styleSheet=document.createStyleSheet(),this.styleSheet.ie7=!0,this.styleSheet.owningElement.ie7=!0,this.styleSheet.cssText=HEADER},getInlineStyles:function(){for(var styleSheet,styleSheets=document.getElementsByTagName("style"),i=styleSheets.length-1;styleSheet=styleSheets[i];i--)styleSheet.disabled||styleSheet.ie7||this.styles.push(styleSheet.innerHTML)},getText:function(styleSheet,path){try{var cssText=styleSheet.cssText}catch(e){cssText=""}return httpRequest&&(cssText=loadFile(styleSheet.href,path)||cssText),cssText},recalc:function(){this.screen.recalc();var rule,calcs,calc,elements,element,i,j,k,id,RECALCS=/ie7_recalc\d+/g,start=HEADER.match(/[{,]/g).length,stop=start+(this.screen.cssText.match(/\{/g)||"").length,rules=this.styleSheet.rules;for(i=start;stop>i;i++){rule=rules[i];var cssText=rule.style.cssText;if(rule&&(calcs=cssText.match(RECALCS))&&(elements=cssQuery(rule.selectorText),elements.length))for(j=0;j<calcs.length;j++)for(id=calcs[j],calc=IE7.CSS.recalcs[id.slice(10)][2],k=0;element=elements[k];k++)element.currentStyle[id]&&calc(element,cssText)}},refresh:function(){this.styleSheet.cssText=HEADER+this.screen+this.print},trash:function(){for(var i=0;i<styleSheets.length;i++)if(!styleSheets[i].ie7){try{var cssText=styleSheets[i].cssText}catch(e){cssText=""}cssText&&(styleSheets[i].cssText="")}}}));var StyleSheet=Base.extend({constructor:function(media){this.media=media,this.load(),IE7.CSS[media]=this,IE7.CSS.refresh()},createRule:function(selector,cssText){if(IE7.CSS.UNKNOWN.test(selector)){var match;if(PseudoElement&&(match=selector.match(PseudoElement.MATCH)))return new PseudoElement(match[1],match[2],cssText);if(!(match=selector.match(DynamicRule.MATCH)))return new Rule(selector,cssText);if(!HYPERLINK.test(match[0])||DynamicRule.COMPLEX.test(match[0]))return new DynamicRule(selector,match[1],match[2],match[3],cssText)}return selector+" {"+cssText+"}"},getText:function(){function _parseMedia(cssText,media){return _filterMedia.value=media,cssText.replace(MEDIA,_filterMedia)}function _filterMedia(match,media,cssText){switch(media=_simpleMedia(media)){case"screen":case"print":if(media!=_filterMedia.value)return"";case"all":return cssText}return""}function _simpleMedia(media){return ALL.test(media)?"all":SCREEN.test(media)?PRINT.test(media)?"all":"screen":PRINT.test(media)?"print":void 0}function _getCSSText(styleSheet,path,media,level){var cssText="";if(level||(media=_simpleMedia(styleSheet.media),level=0),"all"==media||media==self.media){if(3>level)for(var i=0;i<styleSheet.imports.length;i++)cssText+=_getCSSText(styleSheet.imports[i],getPath(styleSheet.href,path),media,level+1);cssText+=encode(styleSheet.href?_loadStyleSheet(styleSheet,path):_inlineStyles.pop()||""),cssText=_parseMedia(cssText,self.media)}return cssText}function _loadStyleSheet(styleSheet,path){var url=makePath(styleSheet.href,path);return fileCache[url]?"":(fileCache[url]=styleSheet.disabled?"":_fixUrls(IE7.CSS.getText(styleSheet,path),getPath(styleSheet.href,path)),fileCache[url])}function _fixUrls(cssText,pathname){return cssText.replace(URL,"$1"+pathname.slice(0,pathname.lastIndexOf("/")+1)+"$2")}for(var _inlineStyles=[].concat(IE7.CSS.styles),MEDIA=/@media\s+([^{]*)\{([^@]+\})\s*\}/gi,ALL=/\ball\b|^$/i,SCREEN=/\bscreen\b/i,PRINT=/\bprint\b/i,self=this,fileCache={},URL=/(url\s*\(\s*['"]?)([\w\.]+[^:\)]*['"]?\))/gi,i=0;i<styleSheets.length;i++)styleSheets[i].disabled||styleSheets[i].ie7||(this.cssText+=_getCSSText(styleSheets[i]))},load:function(){this.cssText="",this.getText(),this.parse(),this.cssText=decode(this.cssText),fileCache={}},parse:function(){this.cssText=IE7.CSS.parser.exec(this.cssText);var rule,selectors,cssText,i,j,offset=IE7.CSS.rules.length,rules=this.cssText.split(BRACE2);for(i=0;i<rules.length;i++){for(rule=rules[i].split(BRACE1),selectors=rule[0].split(COMMA),cssText=rule[1],j=0;j<selectors.length;j++)selectors[j]=cssText?this.createRule(selectors[j],cssText):"";rules[i]=selectors.join("\n")}this.cssText=rules.join("\n"),this.rules=IE7.CSS.rules.slice(offset)},recalc:function(){var rule,i;for(i=0;rule=this.rules[i];i++)rule.recalc()},toString:function(){return"@media "+this.media+"{"+this.cssText+"}"}}),PseudoElement,Rule=IE7.Rule=Base.extend({constructor:function(selector,cssText){this.id=IE7.CSS.rules.length,this.className=Rule.PREFIX+this.id,selector=selector.match(FIRST_LINE_LETTER)||selector||"*",this.selector=selector[1]||selector,this.selectorText=this.parse(this.selector)+(selector[2]||""),this.cssText=cssText,this.MATCH=new RegExp("\\s"+this.className+"(\\s|$)","g"),IE7.CSS.rules.push(this),this.init()},init:Undefined,add:function(element){element.className+=" "+this.className},recalc:function(){for(var match=cssQuery(this.selector),i=0;i<match.length;i++)this.add(match[i])},parse:function(selector){var simple=selector.replace(Rule.CHILD," ").replace(Rule.COMPLEX,"");7>appVersion&&(simple=simple.replace(Rule.MULTI,""));for(var tags=match(simple,Rule.TAGS).length-match(selector,Rule.TAGS).length,classes=match(simple,Rule.CLASSES).length-match(selector,Rule.CLASSES).length+1;classes>0&&Rule.CLASS.test(simple);)simple=simple.replace(Rule.CLASS,""),classes--;for(;tags>0&&Rule.TAG.test(simple);)simple=simple.replace(Rule.TAG,"$1*"),tags--;simple+="."+this.className,classes=Math.min(classes,2),tags=Math.min(tags,2);var score=-10*classes-tags;return score>0&&(simple=simple+","+Rule.MAP[score]+" "+simple),simple},remove:function(element){element.className=element.className.replace(this.MATCH,"$1")},toString:function(){return format("%1 {%2}",this.selectorText,this.cssText)}},{CHILD:/>/g,CLASS:/\.[\w-]+/,CLASSES:/[.:\[]/g,MULTI:/(\.[\w-]+)+/g,PREFIX:"ie7_class",TAG:/^\w+|([\s>+~])\w+/,TAGS:/^\w|[\s>+~]\w/g,MAP:{1:"html",2:"html body",10:".ie7_html",11:"html.ie7_html",12:"html.ie7_html body",20:".ie7_html .ie7_body",21:"html.ie7_html .ie7_body",22:"html.ie7_html body.ie7_body"}}),DynamicRule=Rule.extend({constructor:function(selector,attach,dynamicPseudoClass,target,cssText){this.attach=attach||"*",this.dynamicPseudoClass=IE7.CSS.dynamicPseudoClasses[dynamicPseudoClass],this.target=target,this.base(selector,cssText)},recalc:function(){for(var attach,attaches=cssQuery(this.attach),i=0;attach=attaches[i];i++){var target=this.target?cssQuery(this.target,attach):[attach];target.length&&this.dynamicPseudoClass.apply(attach,target,this)}}}),DynamicPseudoClass=Base.extend({constructor:function(name,apply){this.name=name,this.apply=apply,this.instances={},IE7.CSS.dynamicPseudoClasses[name]=this},register:function(instance){var _class=instance[2];if(instance.id=_class.id+instance[0].uniqueID,!this.instances[instance.id]){var j,target=instance[1];for(j=0;j<target.length;j++)_class.add(target[j]);this.instances[instance.id]=instance}},unregister:function(instance){if(this.instances[instance.id]){var j,_class=instance[2],target=instance[1];for(j=0;j<target.length;j++)_class.remove(target[j]);delete this.instances[instance.id]}}});if(7>appVersion){var Hover=new DynamicPseudoClass("hover",function(element){var instance=arguments;IE7.CSS.addEventHandler(element,5.5>appVersion?"onmouseover":"onmouseenter",function(){Hover.register(instance)}),IE7.CSS.addEventHandler(element,5.5>appVersion?"onmouseout":"onmouseleave",function(){Hover.unregister(instance)})});addEventHandler(document,"onmouseup",function(){var instances=Hover.instances;for(var i in instances)instances[i][0].contains(event.srcElement)||Hover.unregister(instances[i])})}