function fixImage(element){if(PNG.test(element.src)){var image=new Image(element.width,element.height);image.onload=function(){element.width=image.width,element.height=image.height,image=null},image.src=element.src,element.pngSrc=element.src,addFilter(element)}}function addFilter(element,sizingMethod){var filter=element.filters[ALPHA_IMAGE_LOADER];filter?(filter.src=element.src,filter.enabled=!0):(element.runtimeStyle.filter=format(PNG_FILTER,element.src,sizingMethod||"scale"),filtered.push(element)),element.src=BLANK_GIF}function removeFilter(element){element.src=element.pngSrc,element.filters[ALPHA_IMAGE_LOADER].enabled=!1}var BLANK_GIF=makePath("blank.gif",path),ALPHA_IMAGE_LOADER="DXImageTransform.Microsoft.AlphaImageLoader",PNG_FILTER="progid:"+ALPHA_IMAGE_LOADER+"(src='%1',sizingMethod='%2')",PNG,filtered=[];if(appVersion>=5.5&&7>appVersion){IE7.CSS.addFix(/background(-image)?\s*:\s*([^};]*)?url\(([^\)]+)\)([^;}]*)?/,function(match,$1,$2,url,$4){return url=getString(url),PNG.test(url)?"filter:"+format(PNG_FILTER,url,"crop")+";zoom:1;background"+($1||"")+":"+($2||"")+"none"+($4||""):match}),IE7.HTML.addRecalc("img,input",function(element){("INPUT"!=element.tagName||"image"==element.type)&&(fixImage(element),addEventHandler(element,"onpropertychange",function(){printing||"src"!=event.propertyName||-1!=element.src.indexOf(BLANK_GIF)||fixImage(element)}))});var printing=!1;addEventHandler(window,"onbeforeprint",function(){printing=!0;for(var i=0;i<filtered.length;i++)removeFilter(filtered[i])}),addEventHandler(window,"onafterprint",function(){for(var i=0;i<filtered.length;i++)addFilter(filtered[i]);printing=!1})}