var BRACKETS="\\([^)]*\\)";IE7.CSS.pseudoClasses&&(IE7.CSS.pseudoClasses+="|"),IE7.CSS.pseudoClasses+="before|after|last\\-child|only\\-child|empty|root|"+"not|nth\\-child|nth\\-last\\-child|contains|lang".split("|").join(BRACKETS+"|")+BRACKETS,encoder.add(/::/,":"),IE7.CSS.addRecalc("[\\w-]+","inherit",function(element,cssText){if(element.parentElement)for(var inherited=cssText.match(/[\w-]+\s*:\s*inherit/g),i=0;i<inherited.length;i++){var propertyName=inherited[i].replace(/ie7\-|\s*:\s*inherit/g,"").replace(/\-([a-z])/g,function(match,chr){return chr.toUpperCase()});element.runtimeStyle[propertyName]=element.parentElement.currentStyle[propertyName]}});var Focus=new DynamicPseudoClass("focus",function(element){var instance=arguments;IE7.CSS.addEventHandler(element,"onfocus",function(){Focus.unregister(instance),Focus.register(instance)}),IE7.CSS.addEventHandler(element,"onblur",function(){Focus.unregister(instance)}),element==document.activeElement&&Focus.register(instance)}),Active=new DynamicPseudoClass("active",function(element){var instance=arguments;IE7.CSS.addEventHandler(element,"onmousedown",function(){Active.register(instance)})});addEventHandler(document,"onmouseup",function(){var instances=Active.instances;for(var i in instances)Active.unregister(instances[i])});var Checked=new DynamicPseudoClass("checked",function(element){if("boolean"==typeof element.checked){var instance=arguments;IE7.CSS.addEventHandler(element,"onpropertychange",function(){"checked"==event.propertyName&&(element.checked?Checked.register(instance):Checked.unregister(instance))}),element.checked&&Checked.register(instance)}}),Enabled=new DynamicPseudoClass("enabled",function(element){if("boolean"==typeof element.disabled){var instance=arguments;IE7.CSS.addEventHandler(element,"onpropertychange",function(){"disabled"==event.propertyName&&(element.isDisabled?Enabled.unregister(instance):Enabled.register(instance))}),element.isDisabled||Enabled.register(instance)}}),Disabled=new DynamicPseudoClass("disabled",function(element){if("boolean"==typeof element.disabled){var instance=arguments;IE7.CSS.addEventHandler(element,"onpropertychange",function(){"disabled"==event.propertyName&&(element.isDisabled?Disabled.register(instance):Disabled.unregister(instance))}),element.isDisabled&&Disabled.register(instance)}}),Indeterminate=new DynamicPseudoClass("indeterminate",function(element){if("boolean"==typeof element.indeterminate){var instance=arguments;IE7.CSS.addEventHandler(element,"onpropertychange",function(){"indeterminate"==event.propertyName&&(element.indeterminate?Indeterminate.register(instance):Indeterminate.unregister(instance))}),IE7.CSS.addEventHandler(element,"onclick",function(){Indeterminate.unregister(instance)})}}),Target=new DynamicPseudoClass("target",function(element){var instance=arguments;element.tabIndex||(element.tabIndex=0),IE7.CSS.addEventHandler(document,"onpropertychange",function(){"activeElement"==event.propertyName&&(element.id&&element.id==location.hash.slice(1)?Target.register(instance):Target.unregister(instance))}),element.id&&element.id==location.hash.slice(1)&&Target.register(instance)}),ATTR=/^attr/,URL=/^url\s*\(\s*([^)]*)\)$/,POSITION_MAP={before0:"beforeBegin",before1:"afterBegin",after0:"afterEnd",after1:"beforeEnd"},PseudoElement=IE7.PseudoElement=Rule.extend({constructor:function(selector,position,cssText){this.position=position;var match,entity,content=cssText.match(PseudoElement.CONTENT);if(content){content=content[1],match=content.split(/\s+/);for(var i=0;entity=match[i];i++)match[i]=ATTR.test(entity)?{attr:entity.slice(5,-1)}:"'"==entity.charAt(0)?getString(entity):decode(entity);content=match}this.content=content,this.base(selector,decode(cssText))},init:function(){this.match=cssQuery(this.selector);for(var i=0;i<this.match.length;i++){var runtimeStyle=this.match[i].runtimeStyle;runtimeStyle[this.position]||(runtimeStyle[this.position]={cssText:""}),runtimeStyle[this.position].cssText+=";"+this.cssText,null!=this.content&&(runtimeStyle[this.position].content=this.content)}},create:function(target){var generated=target.runtimeStyle[this.position];if(generated){for(var content=[].concat(generated.content||""),j=0;j<content.length;j++)"object"==typeof content[j]&&(content[j]=target.getAttribute(content[j].attr));content=content.join("");var url=content.match(URL),cssText="overflow:hidden;"+generated.cssText.replace(/'/g,'"');"none"!=target.currentStyle.styleFloat;var position=POSITION_MAP[this.position+Number(target.canHaveChildren)],id="ie7_pseudo"+PseudoElement.count++;if(target.insertAdjacentHTML(position,format(PseudoElement.ANON,this.className,id,cssText,url?"":content)),url){var pseudoElement=document.getElementById(id);pseudoElement.src=getString(url[1]),addFilter(pseudoElement,"crop")}target.runtimeStyle[this.position]=null}},recalc:function(){if(null!=this.content)for(var i=0;i<this.match.length;i++)this.create(this.match[i])},toString:function(){return"."+this.className+"{display:inline}"}},{CONTENT:/content\s*:\s*([^;]*)(;|$)/,ANON:"<ie7:! class='ie7_anon %1' id=%2 style='%3'>%4</ie7:!>",MATCH:/(.*):(before|after).*/,count:0});