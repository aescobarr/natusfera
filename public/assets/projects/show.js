$(document).ready(function(){$("#map").taxonMap({preserveViewport:!0}),window.map=$("#map").data("taxonMap");for(var i=0;i<KML_ASSET_URLS.length;i++)lyr=new google.maps.KmlLayer(KML_ASSET_URLS[i],{preserveViewport:PRESERVE_VIEWPORT}),lyr.setMap(window.map),kmlSet=!0;$("#bioblitz_observations .observations").loadObservations({url:OBSERVATIONS_URL,style:"grid",success:function(r){$observations=$("#bioblitz_observations .observation"),$observations.each(function(){var o={id:$(this).attr("id").split("-")[1],latitude:$(this).attr("data-latitude"),longitude:$(this).attr("data-longitude"),coordinates_obscured:$(this).attr("data-coordinates-obscured"),taxonId:$(this).attr("data-taxon-id"),iconic_taxon:{name:$(this).attr("data-iconic-taxon-name")}};map.addObservation(o)}),0==$observations.length&&$("#bioblitz_observations .observations").html($('<div class="meta nocontent"></div>').html(I18n.t("no_observations_yet")));var headers=r.getAllResponseHeaders(),matches=headers.match(/X-Total-Entries: (\d+)/)||[],totalEntries=matches[1],url=OBSERVATIONS_URL.replace(/per_page=[^&]+/,"").replace(/page=[^&]+/,""),totalEntriesLink=$("<a>"+totalEntries+"</a>").attr("href",url);totalEntries&&$(".totalcount .count").html(totalEntriesLink)}}),$("#bioblitz_observations .observationcontrols").observationControls({div:$("#bioblitz_observations .observations"),skipMap:!0}),$("#bioblitzstats").observationUserStats({url:"/observations/user_stats.json?limit=5&"+OBSERVATIONS_URL.split("?")[1]}),$("#bioblitzstats").observationTaxonStats({url:"/observations/taxon_stats.json?"+OBSERVATIONS_URL.split("?")[1]}),$("#lineage").hide(),$("#toggle_lineage").click(function(){$("#lineage").toggle("fold")})});