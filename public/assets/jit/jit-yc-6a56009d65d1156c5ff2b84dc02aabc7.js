!function(){function b(){}function c(w,u){for(var v in u||{})w[v]=u[v];return w}function m(u){return"function"==typeof u?u:function(){return u}}function j(v){var u=h(v);return u?"array"!=u?[v]:v:[]}function g(y,x){var w=h(y);if("object"==w)for(var v in y)x(y[v],v);else for(var u=0;u<y.length;u++)x(y[u],u)}function r(){for(var y={},x=0,u=arguments.length;u>x;x++){var v=arguments[x];if("object"==h(v))for(var w in v){var A=v[w],z=y[w];y[w]=z&&"object"==h(A)&&"object"==h(z)?r(z,A):n(A)}}return y}function n(w){var v;switch(h(w)){case"object":v={};for(var y in w)v[y]=n(w[y]);break;case"array":v=[];for(var x=0,u=w.length;u>x;x++)v[x]=n(w[x]);break;default:return w}return v}function d(y,x){if(y.length<3)return null;if(4==y.length&&0==y[3]&&!x)return"transparent";for(var v=[],u=0;3>u;u++){var w=(y[u]-0).toString(16);v.push(1==w.length?"0"+w:w)}return x?v:"#"+v.join("")}function i(u){f(u),u.parentNode&&u.parentNode.removeChild(u),u.clearAttributes&&u.clearAttributes()}function f(w){for(var v=w.childNodes,u=0;u<v.length;u++)i(v[u])}function t(w,v,u){w.addEventListener?w.addEventListener(v,u,!1):w.attachEvent("on"+v,u)}function s(v,u){return(" "+v.className+" ").indexOf(" "+u+" ")>-1}function p(v,u){s(v,u)||(v.className=v.className+" "+u)}function a(v,u){v.className=v.className.replace(new RegExp("(^|\\s)"+u+"(?:\\s|$)"),"$1")}function e(u){return document.getElementById(u)}var k=Date.now||function(){return+new Date},h=function(u){return h.s.call(u).match(/^\[object\s(.*)\]$/)[1].toLowerCase()};h.s=Object.prototype.toString;var o=function(v){v=v||{};var u=function(){if(this.constructor=u,o.prototyping)return this;var x=this.initialize?this.initialize.apply(this,arguments):this;return x};for(var w in o.Mutators)v[w]&&(v=o.Mutators[w](v,v[w]),delete v[w]);return c(u,this),u.constructor=o,u.prototype=v,u};o.Mutators={Extends:function(w,u){o.prototyping=u.prototype;var v=new u;return delete v.parent,v=o.inherit(v,w),delete o.prototyping,v},Implements:function(u,v){return g(j(v),function(w){o.prototying=w,c(u,"function"==h(w)?new w:w),delete o.prototyping}),u}},c(o,{inherit:function(v,y){var u=arguments.callee.caller;for(var x in y){var w=y[x],A=v[x],z=h(w);A&&"function"==z?w!=A&&(u?(w.__parent=A,v[x]=w):o.override(v,x,w)):v[x]="object"==z?r(A,w):w}return u&&(v.parent=function(){return arguments.callee.caller.__parent.apply(this,arguments)}),v},override:function(v,u,y){var x=o.prototyping;x&&v[u]!=x[u]&&(x=null);var w=function(){var z=this.parent;this.parent=x?x[u]:v[u];var A=y.apply(this,arguments);return this.parent=z,A};v[u]=w}}),o.prototype.implement=function(){var u=this.prototype;return g(Array.prototype.slice.call(arguments||[]),function(v){o.inherit(u,v)}),this},this.TreeUtil={prune:function(v,u){this.each(v,function(x,w){w==u&&x.children&&(delete x.children,x.children=[])})},getParent:function(u,y){if(u.id==y)return!1;var x=u.children;if(x&&x.length>0)for(var w=0;w<x.length;w++){if(x[w].id==y)return u;var v=this.getParent(x[w],y);if(v)return v}return!1},getSubtree:function(u,y){if(u.id==y)return u;for(var w=0,x=u.children;w<x.length;w++){var v=this.getSubtree(x[w],y);if(null!=v)return v}return null},getLeaves:function(w,u){var x=[],v=u||Number.MAX_VALUE;return this.each(w,function(z,y){v>y&&(!z.children||0==z.children.length)&&x.push({node:z,level:v-y})}),x},eachLevel:function(u,z,w,y){if(w>=z){y(u,z);for(var v=0,x=u.children;v<x.length;v++)this.eachLevel(x[v],z+1,w,y)}},each:function(u,v){this.eachLevel(u,0,Number.MAX_VALUE,v)},loadSubtrees:function(D,x){var C=x.request&&x.levelsToShow,y=this.getLeaves(D,C),A=y.length,z={};0==A&&x.onComplete();for(var w=0,u=0;A>w;w++){var B=y[w],v=B.node.id;z[v]=B.node,x.request(v,B.level,{onComplete:function(G,E){var F=E.children;z[G].children=F,++u==A&&x.onComplete()}})}}},this.Canvas=function(){function x(){return x.t=x.t||typeof HTMLCanvasElement,"function"==x.t||"object"==x.t}function w(z,C,B){var A=document.createElement(z);return function(E,F){if(F)for(var D in F)E[D]=F[D];return arguments.callee}(A,C)(A.style,B),"canvas"==z&&!x()&&G_vmlCanvasManager&&(A=G_vmlCanvasManager.initElement(document.body.appendChild(A))),A}function u(z){return document.getElementById(z)}function y(C,B,A,E){var D=A?A-C.width:C.width,z=E?E-C.height:C.height;B.translate(D/2,z/2)}var v={injectInto:"id",width:200,height:200,backgroundColor:"#333333",styles:{fillStyle:"#000000",strokeStyle:"#000000"},backgroundCanvas:!1};return function(B,C){var N,G,z,K,D,J;if(arguments.length<1)throw"Arguments missing";var A=B+"-label",I=B+"-canvas",E=B+"-bkcanvas";C=r(v,C||{});var F={width:C.width,height:C.height};z=w("div",{id:B},r(F,{position:"relative"})),K=w("div",{id:A},{overflow:"visible",position:"absolute",top:0,left:0,width:F.width+"px",height:0});var L={position:"absolute",top:0,left:0,width:F.width+"px",height:F.height+"px"};D=w("canvas",r({id:I},F),L);var H=C.backgroundCanvas;H&&(J=w("canvas",r({id:E},F),L),z.appendChild(J)),z.appendChild(D),z.appendChild(K),u(C.injectInto).appendChild(z),N=D.getContext("2d"),y(D,N);var M=C.styles;for(var O in M)N[O]=M[O];if(H){G=J.getContext("2d");var M=H.styles;for(var O in M)G[O]=M[O];y(J,G),H.impl.init(J,G),H.impl.plot(J,G)}return{id:B,getCtx:function(){return N},getElement:function(){return z},resize:function(S,P){D.width=S,D.height=P,D.style.width=S+"px",D.style.height=P+"px",H&&(J.width=S,J.height=P,J.style.width=S+"px",J.style.height=P+"px"),y(D,N);var Q=C.styles;for(var R in Q)N[R]=Q[R];if(H){var Q=H.styles;for(var R in Q)G[R]=Q[R];y(J,G),H.impl.init(J,G),H.impl.plot(J,G)}},getSize:function(){return{width:D.width,height:D.height}},path:function(P,Q){N.beginPath(),Q(N),N[P](),N.closePath()},clear:function(){var P=this.getSize();N.clearRect(-P.width/2,-P.height/2,P.width,P.height)},clearRectangle:function(T,R,Q,S){if(x())N.clearRect(S,T,Math.abs(R-S),Math.abs(Q-T));else{var P=N.fillStyle;N.fillStyle=C.backgroundColor,N.fillRect(S,T,Math.abs(R-S),Math.abs(Q-T)),N.fillStyle=P}}}}}(),this.Polar=function(v,u){this.theta=v,this.rho=u},Polar.prototype={getc:function(u){return this.toComplex(u)},getp:function(){return this},set:function(u){u=u.getp(),this.theta=u.theta,this.rho=u.rho},setc:function(u,v){this.rho=Math.sqrt(u*u+v*v),this.theta=Math.atan2(v,u),this.theta<0&&(this.theta+=2*Math.PI)},setp:function(v,u){this.theta=v,this.rho=u},clone:function(){return new Polar(this.theta,this.rho)},toComplex:function(w){var u=Math.cos(this.theta)*this.rho,v=Math.sin(this.theta)*this.rho;return w?{x:u,y:v}:new Complex(u,v)},add:function(u){return new Polar(this.theta+u.theta,this.rho+u.rho)},scale:function(u){return new Polar(this.theta,this.rho*u)},equals:function(u){return this.theta==u.theta&&this.rho==u.rho},$add:function(u){return this.theta=this.theta+u.theta,this.rho+=u.rho,this},$madd:function(u){return this.theta=(this.theta+u.theta)%(2*Math.PI),this.rho+=u.rho,this},$scale:function(u){return this.rho*=u,this},interpolate:function(w,C){var y,x=Math.PI,A=2*x,v=function(D){return 0>D?D%A+A:D%A},z=this.theta,B=w.theta;y=Math.abs(z-B)>x?z>B?v(B+(z-A-B)*C):v(B-A+(z-(B-A))*C):v(B+(z-B)*C);var u=(this.rho-w.rho)*C+w.rho;return{theta:y,rho:u}}};var l=function(v,u){return new Polar(v,u)};Polar.KER=l(0,0),this.Complex=function(u,v){this.x=u,this.y=v},Complex.prototype={getc:function(){return this},getp:function(u){return this.toPolar(u)},set:function(u){u=u.getc(!0),this.x=u.x,this.y=u.y},setc:function(u,v){this.x=u,this.y=v},setp:function(v,u){this.x=Math.cos(v)*u,this.y=Math.sin(v)*u},clone:function(){return new Complex(this.x,this.y)},toPolar:function(w){var u=this.norm(),v=Math.atan2(this.y,this.x);return 0>v&&(v+=2*Math.PI),w?{theta:v,rho:u}:new Polar(v,u)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(u){return new Complex(this.x+u.x,this.y+u.y)},prod:function(u){return new Complex(this.x*u.x-this.y*u.y,this.y*u.x+this.x*u.y)},conjugate:function(){return new Complex(this.x,-this.y)},scale:function(u){return new Complex(this.x*u,this.y*u)},equals:function(u){return this.x==u.x&&this.y==u.y},$add:function(u){return this.x+=u.x,this.y+=u.y,this},$prod:function(w){var u=this.x,v=this.y;return this.x=u*w.x-v*w.y,this.y=v*w.x+u*w.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(u){return this.x*=u,this.y*=u,this},$div:function(z){var u=this.x,w=this.y,v=z.squaredNorm();return this.x=u*z.x+w*z.y,this.y=w*z.x-u*z.y,this.$scale(1/v)}};var q=function(v,u){return new Complex(v,u)};Complex.KER=q(0,0),this.Graph=new o({initialize:function(u){var v={complex:!1,Node:{}};this.opt=r(v,u||{}),this.nodes={}},getNode:function(u){return this.hasNode(u)?this.nodes[u]:!1},getAdjacence:function(w,u){var v=[];return this.hasNode(w)&&this.hasNode(u)&&this.nodes[w].adjacentTo({id:u})&&this.nodes[u].adjacentTo({id:w})?(v.push(this.nodes[w].getAdjacency(u)),v.push(this.nodes[u].getAdjacency(w)),v):!1},addNode:function(u){return this.nodes[u.id]||(this.nodes[u.id]=new Graph.Node(c({id:u.id,name:u.name,data:u.data},this.opt.Node),this.opt.complex)),this.nodes[u.id]},addAdjacence:function(x,w,v){var y=[];this.hasNode(x.id)||this.addNode(x),this.hasNode(w.id)||this.addNode(w),x=this.nodes[x.id],w=this.nodes[w.id];for(var u in this.nodes)this.nodes[u].id==x.id&&(this.nodes[u].adjacentTo(w)||y.push(this.nodes[u].addAdjacency(w,v))),this.nodes[u].id==w.id&&(this.nodes[u].adjacentTo(x)||y.push(this.nodes[u].addAdjacency(x,v)));return y},removeNode:function(w){if(this.hasNode(w)){var v=this.nodes[w];for(var u=0 in v.adjacencies){var adj=v.adjacencies[u];this.removeAdjacence(w,adj.nodeTo.id)}delete this.nodes[w]}},removeAdjacence:function(y,x){this.hasNode(y)&&this.nodes[y].removeAdjacency(x),this.hasNode(x)&&this.nodes[x].removeAdjacency(y)},hasNode:function(x){return x in this.nodes}}),Graph.Node=new o({initialize:function(x,z){var y={id:"",name:"",data:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},alpha:1,startAlpha:1,endAlpha:1,pos:z&&q(0,0)||l(0,0),startPos:z&&q(0,0)||l(0,0),endPos:z&&q(0,0)||l(0,0)};c(this,c(y,x))},adjacentTo:function(x){return x.id in this.adjacencies},getAdjacency:function(x){return this.adjacencies[x]},addAdjacency:function(y,z){var x=new Graph.Adjacence(this,y,z);return this.adjacencies[y.id]=x},removeAdjacency:function(x){delete this.adjacencies[x]}}),Graph.Adjacence=function(x,z,y){this.nodeFrom=x,this.nodeTo=z,this.data=y||{},this.alpha=1,this.startAlpha=1,this.endAlpha=1},Graph.Util={filter:function(y){if(!y||"string"!=h(y))return function(){return!0};var x=y.split(" ");return function(A){for(var z=0;z<x.length;z++)if(A[x[z]])return!1;return!0}},getNode:function(x,y){return x.getNode(y)},eachNode:function(B,A,x){var z=this.filter(x);for(var y in B.nodes)z(B.nodes[y])&&A(B.nodes[y])},eachAdjacency:function(A,B,x){var y=A.adjacencies,z=this.filter(x);for(var C in y)z(y[C])&&B(y[C],C)},computeLevels:function(D,E,A,z){A=A||0;var B=this.filter(z);this.eachNode(D,function(F){F._flag=!1,F._depth=-1},z);var y=D.getNode(E);y._depth=A;for(var x=[y];0!=x.length;){var C=x.pop();C._flag=!0,this.eachAdjacency(C,function(F){var G=F.nodeTo;0==G._flag&&B(G)&&(G._depth<0&&(G._depth=C._depth+1+A),x.unshift(G))},z)}},eachBFS:function(C,D,B,y){var z=this.filter(y);this.clean(C);for(var x=[C.getNode(D)];0!=x.length;){var A=x.pop();A._flag=!0,B(A,A._depth),this.eachAdjacency(A,function(E){var F=E.nodeTo;0==F._flag&&z(F)&&(F._flag=!0,x.unshift(F))},y)}},eachLevel:function(B,F,y,C,A){var E=B._depth,x=this.filter(A),D=this;y=y===!1?Number.MAX_VALUE-E:y,function z(I,G,H){var J=I._depth;J>=G&&H>=J&&x(I)&&C(I,J),H>J&&D.eachAdjacency(I,function(K){var L=K.nodeTo;L._depth>J&&z(L,G,H)})}(B,F+E,y+E)},eachSubgraph:function(y,z,x){this.eachLevel(y,0,!1,z,x)},eachSubnode:function(y,z,x){this.eachLevel(y,1,1,z,x)},anySubnode:function(A,z,y){var x=!1;z=z||m(!0);var B="string"==h(z)?function(C){return C[z]}:z;return this.eachSubnode(A,function(C){B(C)&&(x=!0)},y),x},getSubnodes:function(C,D,x){var z=[];if(D=D||0,"array"==h(D))var A=D[0],y=D[1];else var A=D,y=Number.MAX_VALUE-C._depth;return this.eachLevel(C,A,y,function(E){z.push(E)},x),z},getParents:function(y){var x=[];return this.eachAdjacency(y,function(z){var A=z.nodeTo;A._depth<y._depth&&x.push(A)}),x},clean:function(x){this.eachNode(x,function(y){y._flag=!1})}},Graph.Op={options:{type:"nothing",duration:2e3,hideLabels:!0,fps:30},removeNode:function(C,A){var x=this.viz,y=r(this.options,x.controller,A),E=j(C);switch(y.type){case"nothing":for(var z=0;z<E.length;z++)x.graph.removeNode(E[z]);break;case"replot":this.removeNode(E,{type:"nothing"}),x.fx.clearLabels(),x.refresh(!0);break;case"fade:seq":case"fade":for(var B=this,z=0;z<E.length;z++){var D=x.graph.getNode(E[z]);D.endAlpha=0}x.fx.animate(r(y,{modes:["fade:nodes"],onComplete:function(){B.removeNode(E,{type:"nothing"}),x.fx.clearLabels(),x.reposition(),x.fx.animate(r(y,{modes:["linear"]}))}}));break;case"fade:con":for(var B=this,z=0;z<E.length;z++){var D=x.graph.getNode(E[z]);D.endAlpha=0,D.ignore=!0}x.reposition(),x.fx.animate(r(y,{modes:["fade:nodes","linear"],onComplete:function(){B.removeNode(E,{type:"nothing"})}}));break;case"iter":var B=this;x.fx.sequence({condition:function(){return 0!=E.length},step:function(){B.removeNode(E.shift(),{type:"nothing"}),x.fx.clearLabels()},onComplete:function(){y.onComplete()},duration:Math.ceil(y.duration/E.length)});break;default:this.doError()}},removeEdge:function(D,B){var x=this.viz,z=r(this.options,x.controller,B),y="string"==h(D[0])?[D]:D;switch(z.type){case"nothing":for(var A=0;A<y.length;A++)x.graph.removeAdjacence(y[A][0],y[A][1]);break;case"replot":this.removeEdge(y,{type:"nothing"}),x.refresh(!0);break;case"fade:seq":case"fade":for(var C=this,A=0;A<y.length;A++){var E=x.graph.getAdjacence(y[A][0],y[A][1]);E&&(E[0].endAlpha=0,E[1].endAlpha=0)}x.fx.animate(r(z,{modes:["fade:vertex"],onComplete:function(){C.removeEdge(y,{type:"nothing"}),x.reposition(),x.fx.animate(r(z,{modes:["linear"]}))}}));break;case"fade:con":for(var C=this,A=0;A<y.length;A++){var E=x.graph.getAdjacence(y[A][0],y[A][1]);E&&(E[0].endAlpha=0,E[0].ignore=!0,E[1].endAlpha=0,E[1].ignore=!0)}x.reposition(),x.fx.animate(r(z,{modes:["fade:vertex","linear"],onComplete:function(){C.removeEdge(y,{type:"nothing"})}}));break;case"iter":var C=this;x.fx.sequence({condition:function(){return 0!=y.length},step:function(){C.removeEdge(y.shift(),{type:"nothing"}),x.fx.clearLabels()},onComplete:function(){z.onComplete()},duration:Math.ceil(z.duration/y.length)});break;default:this.doError()}},sum:function(F,y){var D=this.viz,G=r(this.options,D.controller,y),C=D.root;switch(D.root=y.id||D.root,G.type){case"nothing":var E=D.construct(F),B=Graph.Util;B.eachNode(E,function(H){B.eachAdjacency(H,function(I){D.graph.addAdjacence(I.nodeFrom,I.nodeTo,I.data)})});break;case"replot":D.refresh(!0),this.sum(F,{type:"nothing"}),D.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":var B=Graph.Util,E=D.construct(F),x=this.preprocessSum(E),z=x?["fade:nodes","fade:vertex"]:["fade:nodes"];D.reposition(),"fade:con"!=G.type?D.fx.animate(r(G,{modes:["linear"],onComplete:function(){D.fx.animate(r(G,{modes:z,onComplete:function(){G.onComplete()}}))}})):(B.eachNode(D.graph,function(H){H.id!=C&&H.pos.getp().equals(Polar.KER)&&(H.pos.set(H.endPos),H.startPos.set(H.endPos))}),D.fx.animate(r(G,{modes:["linear"].concat(z)})));break;default:this.doError()}},morph:function(F,y){var D=this.viz,G=r(this.options,D.controller,y),C=D.root;switch(D.root=y.id||D.root,G.type){case"nothing":var E=D.construct(F),B=Graph.Util;B.eachNode(E,function(H){B.eachAdjacency(H,function(I){D.graph.addAdjacence(I.nodeFrom,I.nodeTo,I.data)})}),B.eachNode(D.graph,function(H){B.eachAdjacency(H,function(I){E.getAdjacence(I.nodeFrom.id,I.nodeTo.id)||D.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)}),E.hasNode(H.id)||D.graph.removeNode(H.id)});break;case"replot":D.refresh(!0),this.morph(F,{type:"nothing"}),D.fx.clearLabels(),D.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":var B=Graph.Util,E=D.construct(F),x=this.preprocessSum(E);B.eachNode(D.graph,function(H){E.hasNode(H.id)||(H.alpha=1,H.startAlpha=1,H.endAlpha=0,H.ignore=!0)}),B.eachNode(D.graph,function(H){H.ignore||B.eachAdjacency(H,function(I){if(!I.nodeFrom.ignore&&!I.nodeTo.ignore){var J=E.getNode(I.nodeFrom.id),K=E.getNode(I.nodeTo.id);if(!J.adjacentTo(K)){var L=D.graph.getAdjacence(J.id,K.id);x=!0,L[0].alpha=1,L[0].startAlpha=1,L[0].endAlpha=0,L[0].ignore=!0,L[1].alpha=1,L[1].startAlpha=1,L[1].endAlpha=0,L[1].ignore=!0}}})});var z=x?["fade:nodes","fade:vertex"]:["fade:nodes"];D.reposition(),B.eachNode(D.graph,function(H){H.id!=C&&H.pos.getp().equals(Polar.KER)&&(H.pos.set(H.endPos),H.startPos.set(H.endPos))}),D.fx.animate(r(G,{modes:["polar"].concat(z),onComplete:function(){B.eachNode(D.graph,function(H){H.ignore&&D.graph.removeNode(H.id)}),B.eachNode(D.graph,function(H){B.eachAdjacency(H,function(I){I.ignore&&D.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)})}),G.onComplete()}}));break;default:this.doError()}},preprocessSum:function(z){var x=this.viz,y=Graph.Util;y.eachNode(z,function(B){if(!x.graph.hasNode(B.id)){x.graph.addNode(B);var C=x.graph.getNode(B.id);C.alpha=0,C.startAlpha=0,C.endAlpha=1}});var A=!1;return y.eachNode(z,function(B){y.eachAdjacency(B,function(C){var D=x.graph.getNode(C.nodeFrom.id),E=x.graph.getNode(C.nodeTo.id);if(!D.adjacentTo(E)){var F=x.graph.addAdjacence(D,E,C.data);D.startAlpha==D.endAlpha&&E.startAlpha==E.endAlpha&&(A=!0,F[0].alpha=0,F[0].startAlpha=0,F[0].endAlpha=1,F[1].alpha=0,F[1].startAlpha=0,F[1].endAlpha=1)}})}),A}},Graph.Plot={Interpolator:{moebius:function(C,E,A){if(1>=E||A.norm()<=1){var z=A.x,D=A.y,B=C.startPos.getc().moebiusTransformation(A);C.pos.setc(B.x,B.y),A.x=z,A.y=D}},linear:function(x,A){var z=x.startPos.getc(!0),y=x.endPos.getc(!0);x.pos.setc((y.x-z.x)*A+z.x,(y.y-z.y)*A+z.y)},"fade:nodes":function(x,A){if(1>=A&&x.endAlpha!=x.alpha){var z=x.startAlpha,y=x.endAlpha;x.alpha=z+(y-z)*A}},"fade:vertex":function(x,A){var z=x.adjacencies;for(var y in z)this["fade:nodes"](z[y],A)},polar:function(y,B){var A=y.startPos.getp(!0),z=y.endPos.getp(),x=z.interpolate(A,B);y.pos.setp(x.theta,x.rho)}},labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(x){return x in this.labels&&null!=this.labels[x]?this.labels[x]:this.labels[x]=document.getElementById(x)},hideLabels:function(y){var x=this.getLabelContainer();x.style.display=y?"none":"",this.labelsHidden=y},clearLabels:function(){for(var x in this.labels)this.viz.graph.hasNode(x)||(this.disposeLabel(x),delete this.labels[x])},disposeLabel:function(y){var x=this.getLabel(y);x&&x.parentNode&&x.parentNode.removeChild(x)},hideLabel:function(B,x){B=j(B);var z,y=x?"":"none",A=this;g(B,function(C){(z=A.getLabel(C.id))&&(z.style.display=y)})},sequence:function(y){var z=this;y=r({condition:m(!1),step:b,onComplete:b,duration:200},y||{});var x=setInterval(function(){y.condition()?y.step():(clearInterval(x),y.onComplete()),z.viz.refresh(!0)},y.duration)},animate:function(z,y){var B=this,x=this.viz,C=x.graph,A=Graph.Util;z=r(x.controller,z||{}),z.hideLabels&&this.hideLabels(!0),this.animation.setOptions(r(z,{$animating:!1,compute:function(E){var D=y?y.scale(-E):null;A.eachNode(C,function(G){for(var F=0;F<z.modes.length;F++)B.Interpolator[z.modes[F]](G,E,D)}),B.plot(z,this.$animating),this.$animating=!0},complete:function(){A.eachNode(C,function(D){D.startPos.set(D.pos),D.startAlpha=D.alpha}),z.hideLabels&&B.hideLabels(!1),B.plot(z),z.onComplete(),z.onAfterCompute()}})).start()},plot:function(y,G){var E=this.viz,B=E.graph,z=E.canvas,x=E.root,C=this,F=z.getCtx(),D=Graph.Util;y=y||this.viz.controller,y.clearCanvas&&z.clear();var A=!!B.getNode(x).visited;D.eachNode(B,function(H){D.eachAdjacency(H,function(I){var J=I.nodeTo;!!J.visited===A&&H.drawn&&J.drawn&&(!G&&y.onBeforePlotLine(I),F.save(),F.globalAlpha=Math.min(Math.min(H.alpha,J.alpha),I.alpha),C.plotLine(I,z,G),F.restore(),!G&&y.onAfterPlotLine(I))}),F.save(),H.drawn&&(F.globalAlpha=H.alpha,!G&&y.onBeforePlotNode(H),C.plotNode(H,z,G),!G&&y.onAfterPlotNode(H)),!C.labelsHidden&&y.withLabels&&(H.drawn&&F.globalAlpha>=.95?C.plotLabel(z,H,y):C.hideLabel(H,!1)),F.restore(),H.visited=!A})},plotLabel:function(A,B,z){var C=B.id,x=this.getLabel(C);if(!x&&!(x=document.getElementById(C))){x=document.createElement("div");var y=this.getLabelContainer();y.appendChild(x),x.id=C,x.className="node",x.style.position="absolute",z.onCreateLabel(x,B),this.labels[B.id]=x}this.placeLabel(x,B,z)},plotNode:function(z,y,G){var E=this.node,B=z.data,D=E.overridable&&B,x=D&&B.$lineWidth||E.lineWidth,A=D&&B.$color||E.color,F=y.getCtx();F.lineWidth=x,F.fillStyle=A,F.strokeStyle=A;var C=z.data&&z.data.$type||E.type;this.nodeTypes[C].call(this,z,y,G)},plotLine:function(E,z,G){var x=this.edge,B=E.data,D=x.overridable&&B,y=D&&B.$lineWidth||x.lineWidth,A=D&&B.$color||x.color,F=z.getCtx();F.lineWidth=y,F.fillStyle=A,F.strokeStyle=A;var C=E.data&&E.data.$type||x.type;this.edgeTypes[C].call(this,E,z,G)},fitsInCanvas:function(z,x){var y=x.getSize();return z.x>=y.width||z.x<0||z.y>=y.height||z.y<0?!1:!0}};var Loader={construct:function(y){var z="array"==h(y),x=new Graph(this.graphOptions);return z?!function(B,E){for(var H=function(J){for(var I=0;I<E.length;I++)if(E[I].id==J)return E[I]},D=0;D<E.length;D++){B.addNode(E[D]);for(var C=0,A=E[D].adjacencies;C<A.length;C++){var G,F=A[C];"string"!=typeof A[C]&&(G=F.data,F=F.nodeTo),B.addAdjacence(E[D],H(F),G)}}}(x,y):!function(A,C){A.addNode(C);for(var B=0,D=C.children;B<D.length;B++)A.addAdjacence(C,D[B]),arguments.callee(A,D[B])}(x,y),x},loadJSON:function(y,x){this.json=y,this.graph=this.construct(y),this.root="array"!=h(y)?y.id:y[x?x:0].id}};this.Trans={linear:function(x){return x}},function(){var x=function(A,z){return z=j(z),c(A,{easeIn:function(B){return A(B,z)},easeOut:function(B){return 1-A(1-B,z)},easeInOut:function(B){return.5>=B?A(2*B,z)/2:(2-A(2*(1-B),z))/2}})},y={Pow:function(A,z){return Math.pow(A,z[0]||6)},Expo:function(z){return Math.pow(2,8*(z-1))},Circ:function(z){return 1-Math.sin(Math.acos(z))},Sine:function(z){return 1-Math.sin((1-z)*Math.PI/2)},Back:function(A,z){return z=z[0]||1.618,Math.pow(A,2)*((z+1)*A-z)},Bounce:function(C){for(var B,A=0,z=1;1;A+=z,z/=2)if(C>=(7-4*A)/11){B=z*z-Math.pow((11-6*A-11*C)/4,2);break}return B},Elastic:function(A,z){return Math.pow(2,10*--A)*Math.cos(20*A*Math.PI*(z[0]||1)/3)}};g(y,function(A,z){Trans[z]=x(A)}),g(["Quad","Cubic","Quart","Quint"],function(A,z){Trans[A]=x(function(B){return Math.pow(B,[z+2])})})}();var Animation=new o({initalize:function(x){this.setOptions(x)},setOptions:function(x){var y={duration:2500,fps:40,transition:Trans.Quart.easeInOut,compute:b,complete:b};return this.opt=r(y,x||{}),this},getTime:function(){return k()},step:function(){var y=this.getTime(),x=this.opt;if(y<this.time+x.duration){var z=x.transition((y-this.time)/x.duration);x.compute(z)}else this.timer=clearInterval(this.timer),x.compute(1),x.complete()},start:function(){return this.time=0,this.startTimer(),this},startTimer:function(){var y=this,x=this.opt;return this.timer?!1:(this.time=this.getTime()-this.time,this.timer=setInterval(function(){y.step()},Math.round(1e3/x.fps)),!0)}});this.ST=function(){function z(H){H=H||this.clickedNode;var D=this.geom,G=Graph.Util,I=this.graph,E=this.canvas,J=H._depth,F=[];G.eachNode(I,function(K){K._depth<=J&&K.exist&&!K.selected&&F.push(K)});var C=D.getRightLevelToShow(H,E);return G.eachLevel(H,C,C,function(K){K.exist&&!K.selected&&F.push(K)}),F}function x(E){var D=[],C=Graph.Util;return E=E||this.clickedNode,C.eachLevel(this.clickedNode,0,this.config.levelsToShow,function(F){F.drawn&&!C.anySubnode(F,"drawn")&&D.push(F)}),D}function A(F){function D(P,M){for(;C[P]!=C[M];){var N=L.getNode(P),O=L.getNode(M);P._depth>M._depth?P=C[P]:M=C[M]}for(;P!=M;){var N=L.getNode(P),O=L.getNode(M);P._depth>M._depth?P=H.getParents(N)[0].id:M=H.getParents(O)[0].id}return P}if(0==y.length)return B=F?F.id:!1,void 0;var H=Graph.Util,L=this.graph,I=this.root,K=0;H.eachNode(L,function(M){K=M._depth>K?M._depth:K});var J=Math.sqrt(K),C={};!function E(N){if(N._depth<J)C[N.id]=I;else{var M=H.getParents(N)[0].id;C[N.id]=N._depth%J?C[M]:M}H.eachSubnode(N,E)}(L.getNode(I)),B=I;for(var G=0;G<y.length;G++)B=D(B,y[G])}var B,y=[];return new o({Implements:Loader,initialize:function(F,C){var D={onBeforeCompute:b,onAfterCompute:b,onCreateLabel:b,onPlaceLabel:b,onComplete:b,onBeforePlotNode:b,onAfterPlotNode:b,onBeforePlotLine:b,onAfterPlotLine:b,request:!1},E={orientation:"left",labelContainer:F.id+"-label",levelsToShow:2,subtreeOffset:8,siblingOffset:5,levelDistance:30,withLabels:!0,clearCanvas:!0,Node:{overridable:!1,type:"rectangle",color:"#ccb",lineWidth:1,height:20,width:90,dim:15,align:"center"},Edge:{overridable:!1,type:"line",color:"#ccc",dim:15,lineWidth:1},duration:700,fps:25,transition:Trans.Quart.easeInOut};this.controller=this.config=r(E,D,C),this.canvas=F,this.graphOptions={complex:!0},this.graph=new Graph(this.graphOptions),this.fx=new ST.Plot(this),this.op=new ST.Op(this),this.group=new ST.Group(this),this.geom=new ST.Geom(this),this.clickedNode=null},plot:function(){this.fx.plot(this.controller)},switchPosition:function(G,F){var C=this.geom,D=this.fx,E=this;D.busy||(D.busy=!0,this.contract({onComplete:function(){C.switchOrientation(G),E.compute("endPos",!1),D.busy=!1,E.onClick(E.clickedNode.id,F)}},G))},addNodeInPath:function(C){y.push(C)},clearNodesInPath:function(){y.length=0},refresh:function(){this.reposition(),this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){Graph.Util.computeLevels(this.graph,this.root,0,"ignore"),this.geom.setRightLevelToShow(this.clickedNode,this.canvas),Graph.Util.eachNode(this.graph,function(C){C.exist&&(C.drawn=!0)}),this.compute("endPos")},compute:function(E,D){var F=E||"startPos",C=this.graph.getNode(this.root);c(C,{drawn:!0,exist:!0,selected:!0}),!D&&"_depth"in C||Graph.Util.computeLevels(this.graph,this.root,0,"ignore"),A.call(this,this.clickedNode),this.computePositions(C,q(0,0),F)},computePositions:function(F,E,O,G){var L=Graph.Util,N=this.geom,G=3==arguments.length||G;B&&F.id==B&&G&&(G=!1),F[O]=E;var C=[];if(L.eachSubnode(F,function(R){C.push(R)}),C.length>0){var I=N.getBaseSize(F,G),K=N.getBaseSize(C[0],G,"available"),Q=1==C.length?this.config.subtreeOffset:I-K,D=C[0][O]=N.getFirstPos(F,E,Q);this.computePositions(C[0],D,O,G);for(var H=1;H<C.length;H++){var J=!L.anySubnode(C[H],"exist")||!L.anySubnode(C[H-1],"exist"),P=N.getBaseSize(C[H],G,"available"),M=J?(N.getSize(C[H],!0)+N.getSize(C[H-1],!0))/2:(K+P)/2;D=N.nextPosition(D,M),K=P,this.computePositions(C[H],D,O,G)}}},requestNodes:function(F,G){var D=r(this.controller,G),C=this.config.levelsToShow,E=Graph.Util;if(D.request){var I=[],H=F._depth;E.eachLevel(F,0,C,function(J){J.drawn&&!E.anySubnode(J)&&(I.push(J),J._level=C-(J._depth-H))}),this.group.requestNodes(I,D)}else D.onComplete()},contract:function(G,H){var F=this.config.orientation,C=this.geom,E=this.group;H&&C.switchOrientation(H);var D=z.call(this);H&&C.switchOrientation(F),E.contract(D,r(this.controller,G))},move:function(D,E){this.compute("endPos",!1);var C=E.Move,F={x:C.offsetX,y:C.offsetY};this.geom.translate(D.endPos.add(F).$scale(-1),"endPos"),this.fx.animate(r(this.controller,{modes:["linear"]},E))},expand:function(D,E){var C=x.call(this,D);this.group.expand(C,r(this.controller,E))},selectPath:function(G){function H(J){if(null!=J&&!J.selected){J.selected=!0,g(E.group.getSiblings([J])[J.id],function(K){K.exist=!0,K.drawn=!0});var I=F.getParents(J);I=I.length>0?I[0]:null,H(I)}}var F=Graph.Util,E=this;F.eachNode(this.graph,function(I){I.selected=!1});for(var C=0,D=[G.id].concat(y);C<D.length;C++)H(this.graph.getNode(D[C]))},addSubtree:function(C,E,D){"replot"==E?this.op.sum(C,c({type:"replot"},D||{})):"animate"==E&&this.op.sum(C,c({type:"fade:seq"},D||{}))},removeSubtree:function(H,D,G,F){var E=this.graph.getNode(H),C=[];Graph.Util.eachLevel(E,+!D,!1,function(I){C.push(I.id)}),"replot"==G?this.op.removeNode(C,c({type:"replot"},F||{})):"animate"==G&&this.op.removeNode(C,c({type:"fade:seq"},F||{}))},select:function(C,F){var K=this.group,I=this.geom,G=this.graph.getNode(C),E=this.canvas;this.graph.getNode(this.root);var D=r(this.controller,F),H=this;D.onBeforeCompute(G),this.selectPath(G),this.clickedNode=G,this.requestNodes(G,{onComplete:function(){K.hide(K.prepare(z.call(H)),D),I.setRightLevelToShow(G,E),H.compute("pos"),Graph.Util.eachNode(H.graph,function(M){var L=M.pos.getc(!0);M.startPos.setc(L.x,L.y),M.endPos.setc(L.x,L.y),M.visited=!1}),H.geom.translate(G.endPos.scale(-1),["pos","startPos","endPos"]),K.show(x.call(H)),H.plot(),D.onAfterCompute(H.clickedNode),D.onComplete()}})},onClick:function(E,L){var F=this.canvas,J=this,C=(this.fx,Graph.Util,this.geom),H={Move:{offsetX:0,offsetY:0},onBeforeRequest:b,onBeforeContract:b,onBeforeMove:b,onBeforeExpand:b},D=r(this.controller,H,L);if(!this.busy){this.busy=!0;var G=this.graph.getNode(E);this.selectPath(G,this.clickedNode),this.clickedNode=G,D.onBeforeCompute(G),D.onBeforeRequest(G),this.requestNodes(G,{onComplete:function(){D.onBeforeContract(G),J.contract({onComplete:function(){C.setRightLevelToShow(G,F),D.onBeforeMove(G),J.move(G,{Move:D.Move,onComplete:function(){D.onBeforeExpand(G),J.expand(G,{onComplete:function(){J.busy=!1,D.onAfterCompute(E),D.onComplete()}})}})}})}})}}})}(),ST.Op=new o({Implements:Graph.Op,initialize:function(x){this.viz=x}}),ST.Group=new o({initialize:function(x){this.viz=x,this.canvas=x.canvas,this.config=x.config,this.animation=new Animation,this.nodes=null,this.siblings=null,this.bbs=null},requestNodes:function(C,B){var A=0,y=C.length,E={},z=function(){B.onComplete()},x=this.viz;0==y&&z();for(var D=0;y>D;D++)E[C[D].id]=C[D],B.request(C[D].id,C[D]._level,{onComplete:function(G,F){F&&F.children&&(F.id=G,x.op.sum(F,{type:"nothing"})),++A==y&&(Graph.Util.computeLevels(x.graph,x.root,0),z())}})},contract:function(z,y){Graph.Util,this.viz;var A=this;z=this.prepare(z),this.animation.setOptions(r(y,{$animating:!1,compute:function(C){1==C&&(C=.99),A.plotStep(1-C,y,this.$animating),this.$animating="contract"},complete:function(){A.hide(z,y)}})).start()},hide:function(z,y){for(var C=Graph.Util,A=(this.viz,0);A<z.length;A++){C.eachLevel(z[A],1,!1,function(D){D.exist&&c(D,{drawn:!1,exist:!1})})}y.onComplete()},expand:function(y,x){var A=this;Graph.Util,this.show(y),this.animation.setOptions(r(x,{$animating:!1,compute:function(B){A.plotStep(B,x,this.$animating),this.$animating="expand"},complete:function(){A.plotStep(void 0,x,!1),x.onComplete()}})).start()},show:function(x){var z=Graph.Util,y=this.config;this.prepare(x),g(x,function(A){z.eachLevel(A,0,y.levelsToShow,function(B){B.exist&&(B.drawn=!0)})})},prepare:function(x){return this.nodes=this.getNodesWithChildren(x),this.siblings=this.getSiblings(this.nodes),this.bbs=this.getBoundingBoxes(this.nodes),this.nodes},getNodesWithChildren:function(y){for(var x=[],A=Graph.Util,z=0;z<y.length;z++)A.anySubnode(y[z],"exist")&&x.push(y[z]);return x},plotStep:function(G,C,I){for(var F=this.viz,y=F.canvas,H=y.getCtx(),z=this.bbs,E=this.siblings,x=this.nodes,B=0;B<x.length;B++){H.save();var A=x[B],D=z[B];y.clearRectangle(D.top,D.right,D.bottom,D.left),F.fx.plotSubtree(A,C,G,I),H.restore(),g(E[A.id],function(J){F.fx.plotNode(J,y,!1)})}},getSiblings:function(x){var z={},y=Graph.Util;return g(x,function(C){var B=y.getParents(C);if(0==B.length)z[C.id]=[C];else{var A=[];y.eachSubnode(B[0],function(D){A.push(D)}),z[C.id]=A}}),z},getBoundingBoxes:function(x){var z=[],y=this.viz.geom;return g(x,function(A){z.push(y.getBoundingBox(A))}),z}}),ST.Geom=new o({initialize:function(x){this.viz=x,this.config=x.config,this.node=x.config.Node,this.edge=x.config.Edge},translate:function(y,x){x=j(x),Graph.Util.eachNode(this.viz.graph,function(z){g(x,function(A){z[A].$add(y)})})},switchOrientation:function(){var x=arguments;if(x.length>0)this.config.orientation=x[0];else{var y=this.dispatch("bottom","top","left","right");this.config.orientation=y}},dispatch:function(){var y=arguments,x=y.length,z=this.config.orientation,A=function(B){return"function"==typeof B?B():B};if(2==x)return"top"==z||"bottom"==z?A(y[0]):A(y[1]);if(4==x)switch(z){case"top":return A(y[0]);case"right":return A(y[1]);case"bottom":return A(y[2]);case"left":return A(y[3])}},getSize:function(E,D){var B=this.node,C=E.data,A=this.node.overridable,y=this.config.siblingOffset,x=(A&&C.$width||B.width)+y,z=(A&&C.$height||B.height)+y;return D?this.dispatch(x,z):this.dispatch(z,x)},getMaxSiblingWidthAndHeight:function(A){var C=this.node,z=Graph.Util,B=this.viz.graph,D=A._depth;if(this.node.overridable){var x=-1,y=-1;
return z.eachNode(B,function(G){if(G._depth==D){var E=G.data.$width||C.width,F=G.data.$height||C.height;x=E>x?E:x,y=F>y?F:y}}),{width:x,height:y}}return this.node},getBoundingBox:function(y){var A=this.node;y.pos,this.config.siblingOffset,Graph.Util;var z=function(N,M){if(0===N||!Graph.Util.anySubnode(M,"exist")){z.boundary=z.boundary||{w:-1,h:-1};var K=M.data.$width||A.width,L=M.data.$height||A.height,J=z.boundary;return J.w=K>J.w?K:J.w,J.h=L>J.h?L:J.h,z.leaf=z.leaf&&z.leaf._depth>M._depth?z.leaf:M,!0}return!1},I=this.getTreeBaseSize(y,Number.MAX_VALUE,z),G=z.boundary,B=z.leaf,D=y,x=D.data.$width||A.width,H=D.data.$height||A.height;if("left"==A.align)return this.dispatch({left:D.pos.x-I/2,bottom:B.pos.y+G.h,top:D.pos.y+H,right:D.pos.x+I/2},{left:B.pos.x,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:D.pos.x},{left:D.pos.x-I/2,bottom:D.pos.y,top:B.pos.y-G.h,right:D.pos.x+I/2},{left:D.pos.x+x,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:B.pos.x+G.w});if("center"==A.align)return this.dispatch({left:D.pos.x-I/2,bottom:B.pos.y+G.h/2,top:D.pos.y+H/2,right:D.pos.x+I/2},{left:B.pos.x-G.w/2,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:D.pos.x-x/2},{left:D.pos.x-I/2,bottom:D.pos.y-H/2,top:B.pos.y-G.h/2,right:D.pos.x+I/2},{left:D.pos.x+x/2,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:B.pos.x+G.w/2});if("right"==A.align)return this.dispatch({left:D.pos.x-I/2,bottom:B.pos.y,top:D.pos.y,right:D.pos.x+I/2},{left:B.pos.x-G.w,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:D.pos.x},{left:D.pos.x-I/2,bottom:D.pos.y-H,top:B.pos.y-G.h,right:D.pos.x+I/2},{left:D.pos.x,bottom:D.pos.y+I/2,top:D.pos.y-I/2,right:B.pos.x+G.w});throw"align: not implemented"},getBaseSize:function(z,x,y){return x?"available"==y?this.getSize(z,!0):this.getTreeBaseSize(z,1,function(B,A){return 0===B&&A.exist}):this.getTreeBaseSize(z,Number.MAX_VALUE,function(B,A){return 0===B||!Graph.Util.anySubnode(A,"exist")})},getTreeBaseSize:function(B,C,y){var z=this.getSize(B,!0),x=0,A=this;return y(C,B)?z:0===C?0:(Graph.Util.eachSubnode(B,function(D){x+=A.getTreeBaseSize(D,C-1,y)}),(z>x?z:x)+this.config.subtreeOffset)},getEdge:function(C,B){var y=function(G,F){return function(){return C.pos.add(new Complex(G,F))}},E=this.node,A=this.node.overridable,D=C.data,x=A&&D.$width||E.width,z=A&&D.$height||E.height;if("begin"==B){if("center"==E.align)return this.dispatch(y(0,z/2),y(-x/2,0),y(0,-z/2),y(x/2,0));if("left"==E.align)return this.dispatch(y(0,z),y(0,0),y(0,0),y(x,0));if("right"==E.align)return this.dispatch(y(0,0),y(-x,0),y(0,-z),y(0,0));throw"align: not implemented"}if("end"==B){if("center"==E.align)return this.dispatch(y(0,-z/2),y(x/2,0),y(0,z/2),y(-x/2,0));if("left"==E.align)return this.dispatch(y(0,0),y(x,0),y(0,z),y(0,0));if("right"==E.align)return this.dispatch(y(0,-z),y(0,0),y(0,0),y(-x,0));throw"align: not implemented"}},getScaledTreePosition:function(B,E){var D=this.node,A=this.node.overridable,C=B.data,x=A&&C.$width||D.width,z=A&&C.$height||D.height,y=function(G,F){return function(){return B.pos.add(new Complex(G,F)).$scale(1-E)}};if("left"==D.align)return this.dispatch(y(0,z),y(0,0),y(0,0),y(x,0));if("center"==D.align)return this.dispatch(y(0,z/2),y(-x/2,0),y(0,-z/2),y(x/2,0));if("right"==D.align)return this.dispatch(y(0,0),y(-x,0),y(0,-z),y(0,0));throw"align: not implemented"},treeFitsInCanvas:function(B,x,C){var z=x.getSize(B),y=this.dispatch(z.width,z.height),A=this.getTreeBaseSize(B,C,function(E,D){return 0===E||!Graph.Util.anySubnode(D)});return y>A},getFirstPos:function(C,E,y){var B=function(G,F){return function(){return new Complex(G,F)}},D=this.getMaxSiblingWidthAndHeight(C),x={data:{$width:D.width,$height:D.height}},A=this.getSize(x)+this.config.levelDistance,z=-y/2+this.config.subtreeOffset/2;return this.dispatch(B(E.x+z,E.y+A),B(E.x-A,E.y+z),B(E.x+z,E.y-A),B(E.x+A,E.y+z))},nextPosition:function(z,x){var y=function(B,A){return function(){return new Complex(B,A)}};return this.dispatch(y(z.x+x,z.y),y(z.x,z.y+x),y(z.x+x,z.y),y(z.x,z.y+x))},setRightLevelToShow:function(z,x){var A=this.getRightLevelToShow(z,x),y=this.viz.fx;Graph.Util.eachLevel(z,0,this.config.levelsToShow,function(C){var B=C._depth-z._depth;B>A?(C.drawn=!1,C.exist=!1,y.hideLabel(C,!1)):C.exist=!0}),z.drawn=!0},getRightLevelToShow:function(y,x){for(var z=this.config.levelsToShow;!this.treeFitsInCanvas(y,x,z)&&z>1;)z--;return z}}),ST.Plot=new o({Implements:Graph.Plot,initialize:function(x){this.viz=x,this.config=x.config,this.node=this.config.Node,this.edge=this.config.Edge,this.animation=new Animation,this.nodeTypes=new ST.Plot.NodeTypes,this.edgeTypes=new ST.Plot.EdgeTypes},plotSubtree:function(C,B,E,z){var x=this.viz,A=x.canvas;if(E=Math.min(Math.max(.001,E),1),E>=0){C.drawn=!1;var y=A.getCtx(),D=x.geom.getScaledTreePosition(C,E);y.translate(D.x,D.y),y.scale(E,E)}this.plotTree(C,!E,B,z),E>=0&&(C.drawn=!0)},plotTree:function(E,B,C,z){var D=this,x=this.viz,A=x.canvas,y=A.getCtx();Graph.Util.eachSubnode(E,function(G){if(G.exist){if(G.drawn){var F=E.getAdjacency(G.id);!z&&C.onBeforePlotLine(F),y.globalAlpha=Math.min(E.alpha,G.alpha),D.plotLine(F,A,z),!z&&C.onAfterPlotLine(F)}D.plotTree(G,B,C,z)}}),E.drawn?(y.globalAlpha=E.alpha,!z&&C.onBeforePlotNode(E),this.plotNode(E,A,z),!z&&C.onAfterPlotNode(E),B&&y.globalAlpha>=.95?this.plotLabel(A,E,C):this.hideLabel(E,!1)):this.hideLabel(E,!0)},placeLabel:function(I,A,D){var G=A.pos.getc(!0),B=this.node,y=this.viz.canvas,H=B.overridable&&A.data.$width||B.width,C=B.overridable&&A.data.$height||B.height,E=y.getSize();if("center"==B.align)var z={x:Math.round(G.x-H/2+E.width/2),y:Math.round(G.y-C/2+E.height/2)};else if("left"==B.align){var F=this.config.orientation;if("bottom"==F||"top"==F)var z={x:Math.round(G.x-H/2+E.width/2),y:Math.round(G.y+E.height/2)};else var z={x:Math.round(G.x+E.width/2),y:Math.round(G.y-C/2+E.height/2)}}else{if("right"!=B.align)throw"align: not implemented";var F=this.config.orientation;if("bottom"==F||"top"==F)var z={x:Math.round(G.x-H/2+E.width/2),y:Math.round(G.y-C+E.height/2)};else var z={x:Math.round(G.x-H+E.width/2),y:Math.round(G.y-C/2+E.height/2)}}var x=I.style;x.left=z.x+"px",x.top=z.y+"px",x.display=this.fitsInCanvas(z,y)?"":"none",D.onPlaceLabel(I,A)},getAlignedPos:function(C,A,x){var z=this.node;if("center"==z.align)var B={x:C.x-A/2,y:C.y-x/2};else if("left"==z.align){var y=this.config.orientation;if("bottom"==y||"top"==y)var B={x:C.x-A/2,y:C.y};else var B={x:C.x,y:C.y-x/2}}else{if("right"!=z.align)throw"align: not implemented";var y=this.config.orientation;if("bottom"==y||"top"==y)var B={x:C.x-A/2,y:C.y-x};else var B={x:C.x-A,y:C.y-x/2}}return B}}),ST.Plot.NodeTypes=new o({none:function(){},circle:function(B,y){var E=B.pos.getc(!0),A=this.node,C=B.data,z=A.overridable&&C,D=z&&C.$dim||A.dim,x=this.getAlignedPos(E,2*D,2*D);y.path("fill",function(F){F.arc(x.x+D,x.y+D,D,0,2*Math.PI,!0)})},square:function(B,y){var E=B.pos.getc(!0),A=this.node,C=B.data,z=A.overridable&&C,D=z&&C.$dim||A.dim,x=this.getAlignedPos(E,D,D);y.getCtx().fillRect(x.x,x.y,D,D)},ellipse:function(z,y){var C=z.pos.getc(!0),D=this.node,A=z.data,B=D.overridable&&A,x=(B&&A.$width||D.width)/2,F=(B&&A.$height||D.height)/2,E=this.getAlignedPos(C,2*x,2*F),G=y.getCtx();G.save(),G.scale(x/F,F/x),y.path("fill",function(H){H.arc((E.x+x)*(F/x),(E.y+F)*(x/F),F,0,2*Math.PI,!0)}),G.restore()},rectangle:function(z,y){var C=z.pos.getc(!0),D=this.node,A=z.data,B=D.overridable&&A,x=B&&A.$width||D.width,F=B&&A.$height||D.height,E=this.getAlignedPos(C,x,F);y.getCtx().fillRect(E.x,E.y,x,F)}}),ST.Plot.EdgeTypes=new o({none:function(){},line:function(y,z){var A=this.viz.geom.getEdge(y.nodeFrom,"begin"),x=this.viz.geom.getEdge(y.nodeTo,"end");z.path("stroke",function(B){B.moveTo(A.x,A.y),B.lineTo(x.x,x.y)})},"quadratic:begin":function(F,y){var E=this.config.orientation,B=F.data,x=this.edge,z=this.viz.geom.getEdge(F.nodeFrom,"begin"),A=this.viz.geom.getEdge(F.nodeTo,"end"),D=x.overridable&&B,C=D&&B.$dim||x.dim;switch(E){case"left":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(z.x+C,z.y,A.x,A.y)});break;case"right":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(z.x-C,z.y,A.x,A.y)});break;case"top":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(z.x,z.y+C,A.x,A.y)});break;case"bottom":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(z.x,z.y-C,A.x,A.y)})}},"quadratic:end":function(F,y){var E=this.config.orientation,B=F.data,x=this.edge,z=this.viz.geom.getEdge(F.nodeFrom,"begin"),A=this.viz.geom.getEdge(F.nodeTo,"end"),D=x.overridable&&B,C=D&&B.$dim||x.dim;switch(E){case"left":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(A.x-C,A.y,A.x,A.y)});break;case"right":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(A.x+C,A.y,A.x,A.y)});break;case"top":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(A.x,A.y-C,A.x,A.y)});break;case"bottom":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.quadraticCurveTo(A.x,A.y+C,A.x,A.y)})}},bezier:function(F,y){var B=F.data,x=this.edge,E=this.config.orientation,z=this.viz.geom.getEdge(F.nodeFrom,"begin"),A=this.viz.geom.getEdge(F.nodeTo,"end"),D=x.overridable&&B,C=D&&B.$dim||x.dim;switch(E){case"left":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.bezierCurveTo(z.x+C,z.y,A.x-C,A.y,A.x,A.y)});break;case"right":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.bezierCurveTo(z.x-C,z.y,A.x+C,A.y,A.x,A.y)});break;case"top":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.bezierCurveTo(z.x,z.y+C,A.x,A.y-C,A.x,A.y)});break;case"bottom":y.path("stroke",function(G){G.moveTo(z.x,z.y),G.bezierCurveTo(z.x,z.y-C,A.x,A.y+C,A.x,A.y)})}},arrow:function(J,B){var D=J.nodeFrom,A=J.nodeTo,E=J.data,x=this.edge,I=x.overridable&&E,L=I&&E.$dim||x.dim;if(I&&E.$direction&&E.$direction.length>1){var y={};y[D.id]=D,y[A.id]=A;var z=E.$direction;D=y[z[0]],A=y[z[1]]}var N=this.viz.geom.getEdge(D,"begin"),C=this.viz.geom.getEdge(A,"end"),H=new Complex(C.x-N.x,C.y-N.y);H.$scale(L/H.norm());var F=new Complex(C.x-H.x,C.y-H.y),G=new Complex(-H.y/2,H.x/2),M=F.add(G),K=F.$add(G.$scale(-1));B.path("stroke",function(O){O.moveTo(N.x,N.y),O.lineTo(C.x,C.y)}),B.path("fill",function(O){O.moveTo(M.x,M.y),O.lineTo(K.x,K.y),O.lineTo(C.x,C.y)})}});var AngularWidth={setAngularWidthForNodes:function(){var x=this.config.Node,z=x.overridable,y=x.dim;Graph.Util.eachBFS(this.graph,this.root,function(C,A){var B=z&&C.data&&C.data.$aw||y;C._angularWidth=B/A},"ignore")},setSubtreesAngularWidth:function(){var x=this;Graph.Util.eachNode(this.graph,function(y){x.setSubtreeAngularWidth(y)},"ignore")},setSubtreeAngularWidth:function(A){var z=this,y=A._angularWidth,x=0;Graph.Util.eachSubnode(A,function(B){z.setSubtreeAngularWidth(B),x+=B._treeAngularWidth},"ignore"),A._treeAngularWidth=Math.max(y,x)},computeAngularWidths:function(){this.setAngularWidthForNodes(),this.setSubtreesAngularWidth()}};this.RGraph=new o({Implements:[Loader,AngularWidth],initialize:function(A,x){var z={labelContainer:A.id+"-label",interpolation:"linear",levelDistance:100,withLabels:!0,Node:{overridable:!1,type:"circle",dim:3,color:"#ccb",width:5,height:5,lineWidth:1},Edge:{overridable:!1,type:"line",color:"#ccb",lineWidth:1},fps:40,duration:2500,transition:Trans.Quart.easeInOut,clearCanvas:!0},y={onBeforeCompute:b,onAfterCompute:b,onCreateLabel:b,onPlaceLabel:b,onComplete:b,onBeforePlotLine:b,onAfterPlotLine:b,onBeforePlotNode:b,onAfterPlotNode:b};this.controller=this.config=r(z,y,x),this.graphOptions={complex:!1,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new Graph(this.graphOptions),this.fx=new RGraph.Plot(this),this.op=new RGraph.Op(this),this.json=null,this.canvas=A,this.root=null,this.busy=!1,this.parent=!1},refresh:function(){this.compute(),this.plot()},reposition:function(){this.compute("endPos")},plot:function(){this.fx.plot()},compute:function(y){var z=y||["pos","startPos","endPos"],x=this.graph.getNode(this.root);x._depth=0,Graph.Util.computeLevels(this.graph,this.root,0,"ignore"),this.computeAngularWidths(),this.computePositions(z)},computePositions:function(E){var y=j(E);this.graph;for(var C=Graph.Util,x=this.graph.getNode(this.root),B=this.parent,z=this.config,A=0;A<y.length;A++)x[y[A]]=l(0,0);x.angleSpan={begin:0,end:2*Math.PI},x._rel=1,C.eachBFS(this.graph,this.root,function(I){var L=I.angleSpan.end-I.angleSpan.begin,O=(I._depth+1)*z.levelDistance,M=I.angleSpan.begin,N=0,F=[];C.eachSubnode(I,function(Q){N+=Q._treeAngularWidth,F.push(Q)},"ignore"),B&&B.id==I.id&&F.length>0&&F[0].dist&&F.sort(function(R,Q){return(R.dist>=Q.dist)-(R.dist<=Q.dist)});for(var J=0;J<F.length;J++){var H=F[J];if(!H._flag){H._rel=H._treeAngularWidth/N;for(var P=H._rel*L,G=M+P/2,K=0;K<y.length;K++)H[y[K]]=l(G,O);H.angleSpan={begin:M,end:M+P},M+=P}}},"ignore")},getNodeAndParentAngle:function(E){var z=!1,D=this.graph.getNode(E),B=Graph.Util.getParents(D),A=B.length>0?B[0]:!1;if(A){var x=A.pos.getc(),C=D.pos.getc(),y=x.add(C.scale(-1));z=Math.atan2(y.y,y.x),0>z&&(z+=2*Math.PI)}return{parent:A,theta:z}},tagChildren:function(B,D){if(B.angleSpan){var C=[];Graph.Util.eachAdjacency(B,function(E){C.push(E.nodeTo)},"ignore");for(var x=C.length,A=0;x>A&&D!=C[A].id;A++);for(var z=(A+1)%x,y=0;D!=C[z].id;z=(z+1)%x)C[z].dist=y++}},onClick:function(B,y){if(this.root!=B&&!this.busy){this.busy=!0,this.root=B,that=this,this.controller.onBeforeCompute(this.graph.getNode(B));var z=this.getNodeAndParentAngle(B);this.tagChildren(z.parent,B),this.parent=z.parent,this.compute("endPos");var x=z.theta-z.parent.endPos.theta;Graph.Util.eachNode(this.graph,function(C){C.endPos.set(C.endPos.getp().add(l(x,0)))});var A=this.config.interpolation;y=r({onComplete:b},y||{}),this.fx.animate(r({hideLabels:!0,modes:[A]},y,{onComplete:function(){that.busy=!1,y.onComplete()}}))}}}),RGraph.Op=new o({Implements:Graph.Op,initialize:function(x){this.viz=x}}),RGraph.Plot=new o({Implements:Graph.Plot,initialize:function(x){this.viz=x,this.config=x.config,this.node=x.config.Node,this.edge=x.config.Edge,this.animation=new Animation,this.nodeTypes=new RGraph.Plot.NodeTypes,this.edgeTypes=new RGraph.Plot.EdgeTypes},placeLabel:function(y,C,z){var E=C.pos.getc(!0),A=this.viz.canvas,x=A.getSize(),D={x:Math.round(E.x+x.width/2),y:Math.round(E.y+x.height/2)},B=y.style;B.left=D.x+"px",B.top=D.y+"px",B.display=this.fitsInCanvas(D,A)?"":"none",z.onPlaceLabel(y,C)}}),RGraph.Plot.NodeTypes=new o({none:function(){},circle:function(z,x){var C=z.pos.getc(!0),y=this.node,B=z.data,A=y.overridable&&B&&B.$dim||y.dim;x.path("fill",function(D){D.arc(C.x,C.y,A,0,2*Math.PI,!0)})},square:function(A,x){var D=A.pos.getc(!0),z=this.node,C=A.data,B=z.overridable&&C&&C.$dim||z.dim,y=2*B;x.getCtx().fillRect(D.x-B,D.y-B,y,y)},rectangle:function(B,y){var D=B.pos.getc(!0),A=this.node,C=B.data,z=A.overridable&&C&&C.$width||A.width,x=A.overridable&&C&&C.$height||A.height;y.getCtx().fillRect(D.x-z/2,D.y-x/2,z,x)},triangle:function(B,y){var F=B.pos.getc(!0),G=this.node,C=B.data,x=G.overridable&&C&&C.$dim||G.dim,A=F.x,z=F.y-x,I=A-x,H=F.y+x,E=A+x,D=H;y.path("fill",function(J){J.moveTo(A,z),J.lineTo(I,H),J.lineTo(E,D)})},star:function(z,y){var D=z.pos.getc(!0),E=this.node,B=z.data,x=E.overridable&&B&&B.$dim||E.dim,F=y.getCtx(),C=Math.PI/5;F.save(),F.translate(D.x,D.y),F.beginPath(),F.moveTo(x,0);for(var A=0;9>A;A++)F.rotate(C),0==A%2?F.lineTo(.200811*(x/.525731),0):F.lineTo(x,0);F.closePath(),F.fill(),F.restore()}}),RGraph.Plot.EdgeTypes=new o({none:function(){},line:function(x,y){var A=x.nodeFrom.pos.getc(!0),z=x.nodeTo.pos.getc(!0);y.path("stroke",function(B){B.moveTo(A.x,A.y),B.lineTo(z.x,z.y)})},arrow:function(J,B){var D=J.nodeFrom,A=J.nodeTo,E=J.data,x=this.edge,I=x.overridable&&E,L=I&&E.$dim||14;if(I&&E.$direction&&E.$direction.length>1){var y={};y[D.id]=D,y[A.id]=A;var z=E.$direction;D=y[z[0]],A=y[z[1]]}var N=D.pos.getc(!0),C=A.pos.getc(!0),H=new Complex(C.x-N.x,C.y-N.y);H.$scale(L/H.norm());var F=new Complex(C.x-H.x,C.y-H.y),G=new Complex(-H.y/2,H.x/2),M=F.add(G),K=F.$add(G.$scale(-1));B.path("stroke",function(O){O.moveTo(N.x,N.y),O.lineTo(C.x,C.y)}),B.path("fill",function(O){O.moveTo(M.x,M.y),O.lineTo(K.x,K.y),O.lineTo(C.x,C.y)})}}),Complex.prototype.moebiusTransformation=function(z){var x=this.add(z),y=z.$conjugate().$prod(this);return y.x++,x.$div(y)},Graph.Util.getClosestNodeToOrigin=function(y,z,x){return this.getClosestNodeToPos(y,Polar.KER,z,x)},Graph.Util.getClosestNodeToPos=function(z,C,B,x){var y=null;B=B||"pos",C=C&&C.getc(!0)||Complex.KER;var A=function(E,D){var G=E.x-D.x,F=E.y-D.y;return G*G+F*F};return this.eachNode(z,function(D){y=null==y||A(D[B].getc(!0),C)<A(y[B].getc(!0),C)?D:y},x),y},Graph.Util.moebiusTransformation=function(z,B,A,y,x){this.eachNode(z,function(D){for(var C=0;C<A.length;C++){var F=B[C].scale(-1),E=y?y:A[C];D[A[C]].set(D[E].getc().moebiusTransformation(F))}},x)},this.Hypertree=new o({Implements:[Loader,AngularWidth],initialize:function(A,x){var z={labelContainer:A.id+"-label",withLabels:!0,Node:{overridable:!1,type:"circle",dim:7,color:"#ccb",width:5,height:5,lineWidth:1,transform:!0},Edge:{overridable:!1,type:"hyperline",color:"#ccb",lineWidth:1},clearCanvas:!0,fps:40,duration:1500,transition:Trans.Quart.easeInOut},y={onBeforeCompute:b,onAfterCompute:b,onCreateLabel:b,onPlaceLabel:b,onComplete:b,onBeforePlotLine:b,onAfterPlotLine:b,onBeforePlotNode:b,onAfterPlotNode:b};this.controller=this.config=r(z,y,x),this.graphOptions={complex:!1,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new Graph(this.graphOptions),this.fx=new Hypertree.Plot(this),this.op=new Hypertree.Op(this),this.json=null,this.canvas=A,this.root=null,this.busy=!1},refresh:function(x){x?(this.reposition(),Graph.Util.eachNode(this.graph,function(y){y.startPos.rho=y.pos.rho=y.endPos.rho,y.startPos.theta=y.pos.theta=y.endPos.theta})):this.compute(),this.plot()},reposition:function(){this.compute("endPos");var x=this.graph.getNode(this.root).pos.getc().scale(-1);Graph.Util.moebiusTransformation(this.graph,[x],["endPos"],"endPos","ignore"),Graph.Util.eachNode(this.graph,function(y){y.ignore&&(y.endPos.rho=y.pos.rho,y.endPos.theta=y.pos.theta)})},plot:function(){this.fx.plot()},compute:function(y){var z=y||["pos","startPos"],x=this.graph.getNode(this.root);x._depth=0,Graph.Util.computeLevels(this.graph,this.root,0,"ignore"),this.computeAngularWidths(),this.computePositions(z)},computePositions:function(F){var G=j(F),B=this.graph,D=Graph.Util,E=this.graph.getNode(this.root);this.config;for(var H=this.canvas.getSize(),z=Math.min(H.width,H.height)/2,A=0;A<G.length;A++)E[G[A]]=l(0,0);E.angleSpan={begin:0,end:2*Math.PI},E._rel=1;var y=function(){var K=0;D.eachNode(B,function(L){K=L._depth>K?L._depth:K,L._scale=z},"ignore");for(var J=.51;1>=J;J+=.01){var I=function(L,M){return(1-Math.pow(L,M))/(1-L)}(J,K+1);if(I>=2)return J-.01}return.5}();D.eachBFS(this.graph,this.root,function(N){for(var J=N.angleSpan.end-N.angleSpan.begin,O=N.angleSpan.begin,M=function(Q){var R=0;return D.eachSubnode(Q,function(S){R+=S._treeAngularWidth},"ignore"),R}(N),L=1,I=0,K=y,P=N._depth;P+1>=L;L++)I+=K,K*=y;D.eachSubnode(N,function(T){if(!T._flag){T._rel=T._treeAngularWidth/M;for(var S=T._rel*J,R=O+S/2,Q=0;Q<G.length;Q++)T[G[Q]]=l(R,I);T.angleSpan={begin:O,end:O+S},O+=S}},"ignore")},"ignore")},onClick:function(z,x){var y=this.graph.getNode(z).pos.getc(!0);this.move(y,x)},move:function(C,z){var y=q(C.x,C.y);if(this.busy===!1&&y.norm()<1){var B=Graph.Util;this.busy=!0;var x=B.getClosestNodeToPos(this.graph,y),A=this;B.computeLevels(this.graph,x.id,0),this.controller.onBeforeCompute(x),y.norm()<1&&(z=r({onComplete:b},z||{}),this.fx.animate(r({modes:["moebius"],hideLabels:!0},z,{onComplete:function(){A.busy=!1,z.onComplete()}}),y))}}}),Hypertree.Op=new o({Implements:Graph.Op,initialize:function(x){this.viz=x}}),Hypertree.Plot=new o({Implements:Graph.Plot,initialize:function(x){this.viz=x,this.config=x.config,this.node=this.config.Node,this.edge=this.config.Edge,this.animation=new Animation,this.nodeTypes=new Hypertree.Plot.NodeTypes,this.edgeTypes=new Hypertree.Plot.EdgeTypes},hyperline:function(I,A){var B=I.nodeFrom,z=I.nodeTo;I.data;var J=B.pos.getc(),E=z.pos.getc(),D=this.computeArcThroughTwoPoints(J,E),K=A.getSize(),C=Math.min(K.width,K.height)/2;if(D.a>1e3||D.b>1e3||D.ratio>1e3)A.path("stroke",function(L){L.moveTo(J.x*C,J.y*C),L.lineTo(E.x*C,E.y*C)});else{var H=Math.atan2(E.y-D.y,E.x-D.x),G=Math.atan2(J.y-D.y,J.x-D.x),y=this.sense(H,G);A.getCtx(),A.path("stroke",function(L){L.arc(D.x*C,D.y*C,D.ratio*C,H,G,y)})}},computeArcThroughTwoPoints:function(L,K){var D=L.x*K.y-L.y*K.x,z=D,C=L.squaredNorm(),B=K.squaredNorm();if(0==D)return{x:0,y:0,ratio:1001};var J=(L.y*B-K.y*C+L.y-K.y)/D,H=(K.x*C-L.x*B+K.x-L.x)/z,I=-J/2,G=-H/2,F=(J*J+H*H)/4-1;if(0>F)return{x:0,y:0,ratio:1001};var E=Math.sqrt(F),A={x:I,y:G,ratio:E,a:J,b:H};return A},sense:function(x,y){return y>x?x+Math.PI>y?!1:!0:y+Math.PI>x?!0:!1},placeLabel:function(F,A,C){var E=A.pos.getc(!0),y=this.viz.canvas,D=y.getSize(),B=A._scale,z={x:Math.round(E.x*B+D.width/2),y:Math.round(E.y*B+D.height/2)},x=F.style;x.left=z.x+"px",x.top=z.y+"px",x.display="",C.onPlaceLabel(F,A)}}),Hypertree.Plot.NodeTypes=new o({none:function(){},circle:function(A,y){var z=this.node,C=A.data,B=z.overridable&&C&&C.$dim||z.dim,D=A.pos.getc(),E=D.scale(A._scale),x=z.transform?B*(1-D.squaredNorm()):B;x>=B/4&&y.path("fill",function(F){F.arc(E.x,E.y,x,0,2*Math.PI,!0)})},square:function(A,z){var F=this.node,C=A.data,x=F.overridable&&C&&C.$dim||F.dim,y=A.pos.getc(),E=y.scale(A._scale),D=F.transform?x*(1-y.squaredNorm()):x,B=2*D;D>=x/4&&z.getCtx().fillRect(E.x-D,E.y-D,B,B)},rectangle:function(A,z){var E=this.node,B=A.data,y=E.overridable&&B&&B.$width||E.width,F=E.overridable&&B&&B.$height||E.height,x=A.pos.getc(),D=x.scale(A._scale),C=1-x.squaredNorm();y=E.transform?y*C:y,F=E.transform?F*C:F,C>=.25&&z.getCtx().fillRect(D.x-y/2,D.y-F/2,y,F)},triangle:function(C,z){var I=this.node,D=C.data,x=I.overridable&&D&&D.$dim||I.dim,y=C.pos.getc(),H=y.scale(C._scale),G=I.transform?x*(1-y.squaredNorm()):x;if(G>=x/4){var B=H.x,A=H.y-G,K=B-G,J=H.y+G,F=B+G,E=J;z.path("fill",function(L){L.moveTo(B,A),L.lineTo(K,J),L.lineTo(F,E)})}},star:function(A,z){var G=this.node,C=A.data,x=G.overridable&&C&&C.$dim||G.dim,y=A.pos.getc(),F=y.scale(A._scale),E=G.transform?x*(1-y.squaredNorm()):x;if(E>=x/4){var H=z.getCtx(),D=Math.PI/5;H.save(),H.translate(F.x,F.y),H.beginPath(),H.moveTo(x,0);for(var B=0;9>B;B++)H.rotate(D),0==B%2?H.lineTo(.200811*(E/.525731),0):H.lineTo(E,0);H.closePath(),H.fill(),H.restore()}}}),Hypertree.Plot.EdgeTypes=new o({none:function(){},line:function(x,y){var z=x.nodeFrom._scale,B=x.nodeFrom.pos.getc(!0),A=x.nodeTo.pos.getc(!0);y.path("stroke",function(C){C.moveTo(B.x*z,B.y*z),C.lineTo(A.x*z,A.y*z)})},hyperline:function(x,y){this.hyperline(x,y)}}),this.TM={layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},innerController:{onBeforeCompute:b,onAfterCompute:b,onComplete:b,onCreateElement:b,onDestroyElement:b,request:!1},config:{orientation:"h",titleHeight:13,rootId:"infovis",offset:4,levelsToShow:3,addLeftClickHandler:!1,addRightClickHandler:!1,selectPathOnHover:!1,Color:{allow:!1,minValue:-100,maxValue:100,minColorValue:[255,0,50],maxColorValue:[0,255,50]},Tips:{allow:!1,offsetX:20,offsetY:20,onShow:b}},initialize:function(x){if(this.tree=null,this.shownTree=null,this.controller=this.config=r(this.config,this.innerController,x),this.rootId=this.config.rootId,this.layout.orientation=this.config.orientation,this.config.Tips.allow&&document.body){var B=document.createElement("div");B.id="_tooltip",B.className="tip";var z=B.style;z.position="absolute",z.display="none",z.zIndex=13e3,document.body.appendChild(B),this.tip=B}var A=this,y=function(){A.empty(),window.CollectGarbage&&window.CollectGarbage(),delete y};window.addEventListener?window.addEventListener("unload",y,!1):window.attachEvent("onunload",y)},each:function(x){!function y(D){if(D){var C=D.childNodes,z=C.length;if(z>0&&x.apply(this,[D,1===z,C[0],C[1]]),z>1)for(var A=C[1].childNodes,B=0;B<A.length;B++)y(A[B])}}(e(this.rootId).firstChild)},toStyle:function(z){var x="";for(var y in z)x+=y+":"+z[y]+";";return x},leaf:function(x){return 0==x.children},createBox:function(y,A,x){if(this.leaf(y))var z=this.leafBox(y,A);else var z=this.headBox(y,A)+this.bodyBox(x,A);return this.contentBox(y,A,z)},plot:function(z){var B=z.coord,y="";if(this.leaf(z))return this.createBox(z,B,null);for(var x=0,A=z.children;x<A.length;x++)y+=this.plot(A[x]);return this.createBox(z,B,y)},headBox:function(y,B){var x=this.config,A=x.offset,z={height:x.titleHeight+"px",width:B.width-A+"px",left:A/2+"px"};return'<div class="head" style="'+this.toStyle(z)+'">'+y.name+"</div>"},bodyBox:function(y,C){var x=this.config,z=x.titleHeight,B=x.offset,A={width:C.width-B+"px",height:C.height-B-z+"px",top:z+B/2+"px",left:B/2+"px"};return'<div class="body" style="'+this.toStyle(A)+'">'+y+"</div>"},contentBox:function(z,B,y){var A={};for(var x in B)A[x]=B[x]+"px";return'<div class="content" style="'+this.toStyle(A)+'" id="'+z.id+'">'+y+"</div>"},leafBox:function(A,E){var z=this.config,y=z.Color.allow&&this.setColor(A),D=z.offset,B=E.width-D,x=E.height-D,C={top:D/2+"px",height:x+"px",width:B+"px",left:D/2+"px"};return y&&(C["background-color"]=y),'<div class="leaf" style="'+this.toStyle(C)+'">'+A.name+"</div>"},setColor:function(F){var A=this.config.Color,B=A.maxColorValue,y=A.minColorValue,C=A.maxValue,G=A.minValue,E=C-G,D=F.data.$color-0,z=function(I,H){return Math.round((B[I]-y[I])/E*(H-G)+y[I])};return d([z(0,D),z(1,D),z(2,D)])},enter:function(x){this.view(x.parentNode.id)},onLeftClick:function(x){this.enter(x)},out:function(){var x=TreeUtil.getParent(this.tree,this.shownTree.id);x&&(this.controller.request&&TreeUtil.prune(x,this.config.levelsToShow),this.view(x.id))},onRightClick:function(){this.out()},view:function(B){var x=this.config,z=this,y={onComplete:function(){z.loadTree(B),e(x.rootId).focus()}};if(this.controller.request){var A=TreeUtil;A.loadSubtrees(A.getSubtree(this.tree,B),r(this.controller,y))}else y.onComplete()},resetPath:function(x){function z(D){var C=D.parentNode;return C&&C.id!=y&&C}function A(F,C){if(F){var D=e(F.id);if(D)for(var E=z(D);E;){var F=E.childNodes[0];s(F,"in-path")?(void 0==C||C)&&a(F,"in-path"):C||p(F,"in-path"),E=z(E)}}}var y=this.rootId,B=this.resetPath.previous;this.resetPath.previous=x||!1,A(B,!0),A(x,!1)},initializeElements:function(){var x=this.controller,z=this,y=m(!1),A=x.Tips.allow;this.each(function(F,E,D,C){var B=TreeUtil.getSubtree(z.tree,F.id);x.onCreateElement(F,B,E,D,C),x.addRightClickHandler&&(D.oncontextmenu=y),(x.addLeftClickHandler||x.addRightClickHandler)&&t(D,"mouseup",function(G){var H=3==G.which||2==G.button;H?x.addRightClickHandler&&z.onRightClick():x.addLeftClickHandler&&z.onLeftClick(D),G.preventDefault?G.preventDefault():G.returnValue=!1}),(x.selectPathOnHover||A)&&(t(D,"mouseover",function(){x.selectPathOnHover&&(E?p(D,"over-leaf"):(p(D,"over-head"),p(F,"over-content")),F.id&&z.resetPath(B)),A&&x.Tips.onShow(z.tip,B,E,D)}),t(D,"mouseout",function(){x.selectPathOnHover&&(E?a(D,"over-leaf"):(a(D,"over-head"),a(F,"over-content")),z.resetPath()),A&&(z.tip.style.display="none")}),A&&t(D,"mousemove",function(J,I){var O=z.tip;I=I||window,J=J||I.event;var N=I.document;N=N.html||N.body;var K={x:J.pageX||J.clientX+N.scrollLeft,y:J.pageY||J.clientY+N.scrollTop};O.style.display="";var I={height:document.body.clientHeight,width:document.body.clientWidth},H={width:O.offsetWidth,height:O.offsetHeight},G=O.style,M=x.Tips.offsetX,L=x.Tips.offsetY;G.top=(K.y+L+H.height>I.height?K.y-H.height-L:K.y+L)+"px",G.left=(K.x+H.width+M>I.width?K.x-H.width-M:K.x+M)+"px"}))})},destroyElements:function(){if(this.controller.onDestroyElement!=b){var x=this.controller,y=this;this.each(function(C,B,A,z){x.onDestroyElement(C,TreeUtil.getSubtree(y.tree,C.id),B,A,z)})}},empty:function(){this.destroyElements(),f(e(this.rootId))},loadTree:function(x){this.empty(),this.loadJSON(TreeUtil.getSubtree(this.tree,x))}},TM.SliceAndDice=new o({Implements:TM,loadJSON:function(A){this.controller.onBeforeCompute(A);var y=e(this.rootId),z=this.config,B=y.offsetWidth,x=y.offsetHeight,C={coord:{top:0,left:0,width:B,height:x+z.titleHeight+z.offset}};null==this.tree&&(this.tree=A),this.shownTree=A,this.compute(C,A,this.layout.orientation),y.innerHTML=this.plot(A),this.initializeElements(),this.controller.onAfterCompute(A)},compute:function(D,M,B){var O=this.config,I=D.coord,L=O.offset,H=I.width-L,F=I.height-L-O.titleHeight,y=D.data,x=y&&"$area"in y?M.data.$area/y.$area:1,N="h"==B;if(N){B="v";var E=Math.round(H*x),G=F,K="height",C="top",A="left"}else{B="h";var G=Math.round(F*x),E=H,K="width",C="left",A="top"}M.coord={width:E,height:G,top:0,left:0};var J=0,z=this;g(M.children,function(P){z.compute(M,P,B),P.coord[C]=J,P.coord[A]=0,J+=Math.floor(P.coord[K])})}}),TM.Area=new o({loadJSON:function(z){this.controller.onBeforeCompute(z);var y=e(this.rootId),A=y.offsetWidth,x=y.offsetHeight,E=this.config.offset,C=A-E,B=x-E-this.config.titleHeight;z.coord={height:x,width:A,top:0,left:0};var D=r(z.coord,{width:C,height:B});this.compute(z,D),y.innerHTML=this.plot(z),null==this.tree&&(this.tree=z),this.shownTree=z,this.initializeElements(),this.controller.onAfterCompute(z)},computeDim:function(A,E,y,D,z){if(1==A.length+E.length){var x=1==A.length?A:E;return this.layoutLast(x,y,D),void 0}if(A.length>=2&&0==E.length&&(E=[A[0]],A=A.slice(1)),0==A.length)return E.length>0&&this.layoutRow(E,y,D),void 0;var C=A[0];if(z(E,y)>=z([C].concat(E),y))this.computeDim(A.slice(1),E.concat([C]),y,D,z);else{var B=this.layoutRow(E,y,D);this.computeDim(A,[],B.dim,B,z)}},worstAspectRatio:function(x,E){if(!x||0==x.length)return Number.MAX_VALUE;for(var y=0,F=0,B=Number.MAX_VALUE,C=0;C<x.length;C++){var z=x[C]._area;y+=z,B=z>B?B:z,F=F>z?F:z}var D=E*E,A=y*y;return Math.max(D*F/A,A/(D*B))},avgAspectRatio:function(A,x){if(!A||0==A.length)return Number.MAX_VALUE;for(var C=0,y=0;y<A.length;y++){var B=A[y]._area,z=B/x;C+=x>z?x/z:z/x}return C/A.length},layoutLast:function(y,x,z){y[0].coord=z}}),TM.Squarified=new o({Implements:[TM,TM.Area],compute:function(F,C){C.width>=C.height&&this.layout.horizontal()||this.layout.change();var x=F.children,z=this.config;if(x.length>0){this.processChildrenLayout(F,x,C);for(var B=0;B<x.length;B++){var A=x[B].coord,D=z.offset,E=A.height-(z.titleHeight+D),y=A.width-D,C={width:y,height:E,top:0,left:0};this.compute(x[B],C)}}},processChildrenLayout:function(F,x,B){for(var y=B.width*B.height,C=0,G=[],A=0;A<x.length;A++)G[A]=parseFloat(x[A].data.$area),C+=G[A];for(var A=0;A<G.length;A++)x[A]._area=y*G[A]/C;var z=this.layout.horizontal()?B.height:B.width;x.sort(function(I,H){return(I._area<=H._area)-(I._area>=H._area)});var E=[x[0]],D=x.slice(1);this.squarify(D,E,z,B)},squarify:function(y,A,x,z){this.computeDim(y,A,x,z,this.worstAspectRatio)},layoutRow:function(y,x,z){return this.layout.horizontal()?this.layoutV(y,x,z):this.layoutH(y,x,z)},layoutV:function(x,E,B){var F=0;g(x,function(G){F+=G._area});for(var y=F/E,C=0,z=0;z<x.length;z++){var A=x[z]._area/y;x[z].coord={height:A,width:y,top:B.top+(E-A-C),left:B.left},C+=A}var D={height:B.height,width:B.width-y,top:B.top,left:B.left+y};return D.dim=Math.min(D.width,D.height),D.dim!=D.height&&this.layout.change(),D},layoutH:function(x,D,A){var F=0;g(x,function(G){F+=G._area});for(var E=F/D,B=A.height-E,y=0,z=0;z<x.length;z++)x[z].coord={height:E,width:x[z]._area/E,top:B,left:A.left+y},y+=x[z].coord.width;var C={height:A.height-E,width:A.width,top:A.top,left:A.left};return C.dim=Math.min(C.width,C.height),C.dim!=C.width&&this.layout.change(),C}}),TM.Strip=new o({Implements:[TM,TM.Area],compute:function(F,C){var x=F.children,z=this.config;if(x.length>0){this.processChildrenLayout(F,x,C);for(var B=0;B<x.length;B++){var A=x[B].coord,D=z.offset,E=A.height-(z.titleHeight+D),y=A.width-D,C={width:y,height:E,top:0,left:0};this.compute(x[B],C)}}},processChildrenLayout:function(A,z,E){var B=E.width*E.height,C=parseFloat(A.data.$area);g(z,function(F){F._area=B*parseFloat(F.data.$area)/C});var y=this.layout.horizontal()?E.width:E.height,D=[z[0]],x=z.slice(1);this.stripify(x,D,y,E)},stripify:function(y,A,x,z){this.computeDim(y,A,x,z,this.avgAspectRatio)},layoutRow:function(y,x,z){return this.layout.horizontal()?this.layoutH(y,x,z):this.layoutV(y,x,z)},layoutV:function(x,E,B){var F=0;g(x,function(G){F+=G._area});for(var y=F/E,C=0,z=0;z<x.length;z++){var A=x[z]._area/y;x[z].coord={height:A,width:y,top:B.top+(E-A-C),left:B.left},C+=A}var D={height:B.height,width:B.width-y,top:B.top,left:B.left+y,dim:E};return D},layoutH:function(x,D,A){var F=0;g(x,function(G){F+=G._area});for(var E=F/D,B=A.height-E,y=0,z=0;z<x.length;z++)x[z].coord={height:E,width:x[z]._area/E,top:B,left:A.left+y},y+=x[z].coord.width;var C={height:A.height-E,width:A.width,top:A.top,left:A.left,dim:D};
return C}})}();