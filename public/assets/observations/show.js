function showCommunityTaxonDialog(){var dialogId="community_taxon_dialog",dialog=$("#"+dialogId);return 0==dialog.length?(dialog=$("<div></div>").addClass("dialog").html('<div class="loading status">'+I18n.t("loading")+"</div>"),dialog.attr("id",dialogId),dialog.load("/observations/"+window.observation.id+"/community_taxon_summary",function(){$(dialog).hasClass("dialogcentered")||($(dialog).centerDialog(),$(dialog).addClass("dialogcentered"))}),dialog.dialog({modal:!0,title:I18n.t("about_community_taxa"),width:"80%",minHeight:600})):$(dialog).dialog("open"),!1}$(document).ready(function(){window.observation=OBSERVATION,$("#map").taxonMap({clickable:!1,showAccuracy:!0}),window.map=$("#map").data("taxonMap"),map&&$(window).load(function(){var newHeight,photosHeight=$("#photos .first img").height(),soundsHeight=$("#sounds").height()-$("#sounds .moresounds").height()-$("#sounds .meta").height(),mediaWidth=$("#media").width(),newWidth=$("#where-and-photos").width()-mediaWidth;photosHeight&&soundsHeight?newHeight=soundsHeight+$("#photos").height():photosHeight?newHeight=photosHeight:soundsHeight&&(newHeight=soundsHeight-10),newWidth&&(newWidth-=11,$("#where").width(newWidth),$("#map").width(newWidth)),newHeight&&$("#map").height(newHeight),map&&observation&&google.maps.event.trigger(map,"resize")}),$(".identification_form_wrapper input.text").simpleTaxonSelector({buttonText:I18n.t("find"),afterSelect:function(wrapper){var button=$(wrapper).parents(".identification_form_wrapper").find(".default.button");$(button).removeClass("disabled").attr("disabled",null),$(button).focus()},afterUnselect:function(wrapper){var button=$(wrapper).parents(".identification_form_wrapper").find(".default.button");$(button).addClass("disabled").attr("disabled","disabled")}}),$(".identification_form_wrapper .default.button").addClass("disabled").attr("disabled","disabled"),$("#new_identification_form .default.button").addClass("disabled").attr("disabled","disabled"),$("#new_identification_form .species_guess").simpleTaxonSelector({buttonText:I18n.t("find"),afterSelect:function(){var button=$("#new_identification_form").find(".default.button");$(button).removeClass("disabled").attr("disabled",null)},afterUnselect:function(){var button=$("#new_identification_form").find(".default.button");$(button).addClass("disabled").attr("disabled","disabled")}}),$("#forms").tabs(),$(".quality_assessment .quality_metric_vote_link").live("click",function(e){e.preventDefault();var tr=$(this).parents("tr.quality_metric");$.ajax({url:$(this).attr("href"),dataType:"json",type:$(this).attr("data-http-method"),data:{authenticity_token:$("meta[name=csrf-token]").attr("content")},success:function(data){data.error?alert(data.error):data.html&&tr.replaceWith(data.html)}})}),$("a[rel=alternate]").each(function(){$(this).css({background:"url(http://www.google.com/s2/favicons?domain="+this.hostname+") left center no-repeat","background-size":"16px 16px",padding:"1px 0 1px 20px"})}),$("#added_to_id_please .button").bind("ajax:before",function(){$("#added_to_id_please").fadeOut(function(){$("#need_id_help").fadeIn()})}),$("#need_id_help .button").bind("ajax:before",function(){$("#need_id_help").fadeOut(function(){$("#added_to_id_please").fadeIn()})}),$("#project_menu .addlink").bind("ajax:before",function(){var loading=$("<div>&nbsp;</div>").addClass("loadingclick inter");loading.width($(this).width()),loading.height($(this).height()),loading.css({backgroundPosition:"center center"}),$(this).hide(),$(this).after(loading)}).bind("ajax:success",function(e,json){$(this).data("project-id")||json.project_id,$(this).siblings(".loadingclick").remove(),$(this).siblings(".removelink").show(),$(this).hide()}).bind("ajax:error",function(){$(this).siblings(".loadingclick").remove(),$(this).show()}),$("#project_menu .removelink").bind("ajax:before",function(){var loading=$("<div>&nbsp;</div>").addClass("loadingclick inter");loading.width($(this).width()),loading.height($(this).height()),loading.css({backgroundPosition:"center center"}),$(this).hide(),$(this).after(loading)}).bind("ajax:success",function(){$(this).siblings(".loadingclick").remove(),$(this).siblings(".addlink").show(),$(this).hide()}).bind("ajax:error",function(){}),$(".identification").each(function(){var taxonId=$(this).data("taxon-id");if(taxonId){var tipOptions=$.extend(!0,{},QTIP_DEFAULTS,{position:{my:"right center",at:"left center",target:"event"},style:{width:500},show:{delay:1e3,solo:!0},hide:{event:"mouseleave unfocus",delay:500},content:{text:'<span class="loading status">Loading...</span>',ajax:{url:"/taxa/"+taxonId+"/tip",type:"GET",data:{observation_id:observation.id}}}});$(this).qtip(tipOptions)}}),$("[class*=bold-]").boldId()}),$("#add_more_photos_link").live("click",function(){var dialogId="add_more_photos_dialog",dialog=$("#"+dialogId);return 0==dialog.length?(dialog=$("<div></div>").addClass("dialog").html('<div class="loading status">'+I18n.t("loading")+"</div>"),dialog.attr("id",dialogId),dialog.load("/observations/"+window.observation.id+"/edit?partial=add_photos",function(){var authenticity_token=$("meta[name=csrf-token]").attr("content"),index=window.location.href.match(/\/observations\/(\d+)/)[1],options={urlParams:{authenticity_token:authenticity_token,index:index,limit:18,synclink_base:window.location.href},sources:PHOTO_SOURCES,defaultSource:DEFAULT_PHOTO_SOURCE,afterQueryPhotos:function(){$(dialog).hasClass("dialogcentered")||($(dialog).centerDialog(),$(dialog).addClass("dialogcentered"))}};$(".observation_photos",this).photoSelector(options)}),dialog.dialog({modal:!0,title:I18n.t("add_photos_to_this_observation"),width:760,minHeight:300})):$(dialog).dialog("open"),!1});