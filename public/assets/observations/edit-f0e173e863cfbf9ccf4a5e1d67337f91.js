function handleTaxonClick(e,taxon){$.fn.simpleTaxonSelector.selectTaxon($(".simpleTaxonSelector:first"),taxon),$("#taxonchooser").dialog("close")}function afterFindPlaces(){TaxonBrowser.ajaxify("#find_places")}$(document).ready(function(){$(".species_guess").simpleTaxonSelector(),$(".observed_on_string").iNatDatepicker();var map=iNaturalist.Map.createMap({div:$("#map").get(0),mapTypeId:google.maps.MapTypeId.HYBRID,bounds:BOUNDS});window.map=map;var preserveViewport=!1;if("undefined"!=typeof PROJECT&&PROJECT&&(preserveViewport=PROJECT.latitude&&PROJECT.zoom_level,PROJECT.latitude&&map.setCenter(new google.maps.LatLng(PROJECT.latitude,PROJECT.longitude)),PROJECT.zoom_level&&map.setZoom(PROJECT.zoom_level),PROJECT.map_type&&map.setMapTypeId(PROJECT.map_type)),"undefined"!=typeof PLACE&&PLACE)window.map.addPlaceLayer({place:PLACE}),map.setPlace(PLACE,{preserveViewport:preserveViewport,click:function(e){$.fn.latLonSelector.handleMapClick(e)}}),map.controls[google.maps.ControlPosition.TOP_RIGHT].push(new iNaturalist.OverlayControl(map).div);else if("undefined"!=typeof KML_ASSET_URLS&&null!=KML_ASSET_URLS&&KML_ASSET_URLS.length>0){for(var i=0;i<KML_ASSET_URLS.length;i++)lyr=new google.maps.KmlLayer(KML_ASSET_URLS[i],{preserveViewport:preserveViewport,suppressInfoWindows:!0}),map.addOverlay("KML Layer",lyr),google.maps.event.addListener(lyr,"click",function(e){$.fn.latLonSelector.handleMapClick(e)});map.controls[google.maps.ControlPosition.TOP_RIGHT].push(new iNaturalist.OverlayControl(map).div)}$(".place_guess").latLonSelector({mapDiv:$("#map").get(0),map:map}),$("#mapcontainer").hover(function(){$("#mapcontainer .description").fadeOut()}),$("body").append($('<div id="taxonchooser" class="clear dialog"></div>').append($('<div id="taxon_browser" class="clear"></div>').append($('<div class="loading status">'+I18n.t("loading")+"</div>"))).hide()),$("#taxonchooser").dialog({autoOpen:!1,width:.8*$(window).width(),height:.8*$(window).height(),title:I18n.t("browse_all_species"),modal:!0,minWidth:1e3,open:function(){$("#taxon_browser").load("/taxa/search?partial=browse&js_link=true",function(){TaxonBrowser.ajaxify()})}}),$(".observation_fields_form_fields").observationFieldsForm(),$(".observation_photos").each(function(){var authenticity_token=$(this).parents("form").find("input[name=authenticity_token]").val();if(window.location.href.match(/\/observations\/(\d+)/))var index=window.location.href.match(/\/observations\/(\d+)/)[1];else var index=0;var options={urlParams:{authenticity_token:authenticity_token,index:index,limit:15,synclink_base:window.location.href}};DEFAULT_PHOTO_IDENTITY_URL?options.baseURL=DEFAULT_PHOTO_IDENTITY_URL:options.defaultSource="local",PHOTO_IDENTITY_URLS&&PHOTO_IDENTITY_URLS.length>0&&(options.urls=PHOTO_IDENTITY_URLS),$(this).photoSelector(options)}),SOUNDCLOUD_IDENTITY&&$(".observation_sounds").each(function(){var index=(window.location.href.match(/\/observations\/(\d+)/)||[])[1]||0;$(this).soundSelector({index:index})}),$(".ui-tabs").tabs(),0!=$("#accept_terms").length&&($("input[type=submit].default").attr("exception","true"),$(".observationform").submit(function(){if(!$("input[type=checkbox]#accept_terms").is(":checked")){var c=confirm("You didn't agree to the project's terms, this will still save the observation to iNaturalist, but it won't be added to the project. Is this what you want?");if(!c)return!1}}))});